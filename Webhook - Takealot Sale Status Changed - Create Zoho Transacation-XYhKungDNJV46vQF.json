[
  {
    "updatedAt": "2026-02-04T15:12:54.527Z",
    "createdAt": "2026-01-01T15:28:55.444Z",
    "id": "XYhKungDNJV46vQF",
    "name": "Webhook - Takealot Sale Status Changed - Create Zoho Transacation",
    "description": null,
    "active": true,
    "isArchived": false,
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": ":seller_id",
          "options": {
            "rawBody": true
          }
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          -528,
          464
        ],
        "id": "fd6cf5b0-c95c-48ad-be0e-cc46d02762ec",
        "name": "Webhook",
        "webhookId": "fa329524-5a4e-4fab-a636-cfcd3b496f4b"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://accounts.zoho.com/oauth/v2/token",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpCustomAuth",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          2016,
          368
        ],
        "id": "357e44a9-f2f4-4ec2-9f49-98a4a12e46dc",
        "name": "Get Zoho Access Token",
        "credentials": {
          "httpCustomAuth": {
            "id": "9SvOEsYF9SjtHbhQ",
            "name": "Zoho_Access_Token"
          }
        }
      },
      {
        "parameters": {
          "url": "https://www.zohoapis.com/inventory/v1/items",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              },
              {
                "name": "search_text",
                "value": "={{ $('Webhook').item.json.body.sale.sku.substring(0, 4) }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $json.access_token }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          2240,
          368
        ],
        "id": "b17cc03e-80a5-438e-a669-8bf82b27a4e8",
        "name": "Get Item ID from SKU"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $('Set Endpoint').item.json.zoho_endpoint }}/{{ $json.salesorder_id }}/status/confirmed",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          4240,
          -416
        ],
        "id": "65ea9213-8821-474b-b8a6-0533fc805532",
        "name": "Confirm Salesorder",
        "retryOnFail": true,
        "maxTries": 2,
        "waitBetweenTries": 2000,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "4841da88-677c-4093-9e86-9a06ac2a6f83",
                "name": "zoho_endpoint",
                "value": "={{ ({\n  2: \"https://www.zohoapis.com/inventory/v1/salesorders\",\n  3: \"https://www.zohoapis.com/inventory/v1/invoices\",\n  19: \"https://www.zohoapis.com/inventory/v1/creditnotes\"\n})[$('Webhook').item.json.body.sale.sale_status_id] || null }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1568,
          464
        ],
        "id": "b2c36f0d-80be-4c33-97b8-128c72e7ea10",
        "name": "Set Endpoint"
      },
      {
        "parameters": {
          "mode": "raw",
          "jsonOutput": "={\n  \"customer_id\": \"{{ $('Get row(s)').item.json.CustomerID }}\",\n\"date\": \"{{ (() => {\n  const date = $('Webhook').item.json.body.event_timestamp_utc.split('T')[0];\n  if (!/^\\d{4}-\\d{2}-\\d{2}$/.test(date)) {\n    throw new Error('Invalid date format');\n  }\n  return date;\n})() }}\",\n  \"doc_number\": \"{{ $('Webhook').item.json.body.sale.order_item_id }}(Order: {{ $('Webhook').item.json.body.sale.order_id }})\",\n  \"order_id\": {{ $('Webhook').item.json.body.sale.order_id }},\n  \"order_item_id\": {{ $('Webhook').item.json.body.sale.order_item_id }},\n  \"reference_number\": \"{{ $('Webhook').item.json.body.sale.order_item_id }}(Order: {{ $('Webhook').item.json.body.sale.order_id }})\",\n  \"salesorder_number\": \"{{ $('Webhook').item.json.body.sale.order_item_id }}(Order: {{ $('Webhook').item.json.body.sale.order_id }})\",\n  \"is_inclusive_tax\": true,\n  \"due_date\": {{ $('Webhook').item.json.body.event_timestamp_utc.slice(0, 10) }},\n  \"location_id\": \"{{ $('Get row(s)').item.json.ParentLocationID }}\",\n  \"notes\": \"Customer name: {{ $('Webhook').item.json.body.sale.customer }}\",\n  \"line_items\": [{\n    \"item_id\": \"{{ $('Get Item ID from SKU').item.json.items[0].item_id }}\",\n    \"name\": \"{{ $('Webhook').item.json.body.sale.product_title }}\",\n    \"rate\": {{ (() => {\n  const price = $('Webhook').item.json.body.sale.selling_price;\n  const qty = $('Webhook').item.json.body.sale.quantity;\n  if (qty === 0) throw new Error('Quantity cannot be zero');\n  return price / qty;\n})() }},\n    \"quantity\": {{ $('Webhook').item.json.body.sale.quantity }},\n    \"tax_id\": \"{{ $('Get row(s)').item.json.TaxID }}\",\n    \"item_total\": {{ $('Webhook').item.json.body.sale.selling_price }},\n    \"location_id\": \"{{ $('Get row(s)').item.json.LocationID }}\"\n  }]\n }",
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          2480,
          368
        ],
        "id": "d099e97d-a493-4ba0-bf3a-202815532fba",
        "name": "Build JSON",
        "notes": "Added date check to see if date is valid and safe division for \"rate\" in case quantity is zero"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $('Set Endpoint').item.json.zoho_endpoint }}/{{ $json.invoice_id }}/status/sent",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          6560,
          112
        ],
        "id": "f3b3b099-d358-4179-894f-27d95f6e8003",
        "name": "Mark Invoice as Sent"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $('Set Endpoint').item.json.zoho_endpoint }}/mapwithorder",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              },
              {
                "name": "invoice_ids",
                "value": "={{ $('Extract invoice_id').item.json.invoice_id }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          6768,
          112
        ],
        "id": "79ea6a67-3a85-4bc6-ba23-f675df713a7d",
        "name": "Map to Salesorder"
      },
      {
        "parameters": {
          "operation": "get",
          "dataTableId": {
            "__rl": true,
            "value": "P2idoCVDSQnCITNY",
            "mode": "list",
            "cachedResultName": "zoho_info",
            "cachedResultUrl": "/projects/A2rkQg960Oa5Tvrh/datatables/P2idoCVDSQnCITNY"
          },
          "filters": {
            "conditions": [
              {
                "keyName": "SellerID",
                "keyValue": "={{ $('Webhook').item.json.params.seller_id }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1.1,
        "position": [
          -64,
          416
        ],
        "id": "b7faec4b-cd5a-44a4-9152-87aacdf90fea",
        "name": "Get row(s)"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          2016,
          560
        ],
        "id": "12f4f9ef-1f63-47f8-9219-4c1e55029ef9",
        "name": "No Operation, do nothing"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "8f3e18e0-c669-4dd3-a2e7-f8c04ba01d7a",
                "leftValue": "={{ $('Set Endpoint').item.json.zoho_endpoint }}",
                "rightValue": 3,
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          1792,
          464
        ],
        "id": "56528ec2-07b7-4f83-a907-c7f4b6083fb3",
        "name": "if valid transaction"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://www.zohoapis.com/inventory/v1/packages",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              },
              {
                "name": "salesorder_id",
                "value": "={{ $json.body.salesorder.salesorder_id }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"package_number\": \"{{ $json.body.salesorder.salesorder_number }}\",\n  \"date\": \"{{ $json.body.salesorder.date }}\",\n  \"line_items\": [\n    {\n      \"so_line_item_id\": \"{{ $json.body.salesorder.line_items[0].line_item_id }}\",\n      \"quantity\": {{ $json.body.salesorder.line_items[0].quantity }}\n    }\n  ],\n  \"notes\": \"{{ $json.body.salesorder.notes }}\"\n} ",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          4928,
          -672
        ],
        "id": "41afaa63-5132-4ae6-afa9-83a1dd3f9472",
        "name": "Create package",
        "retryOnFail": true,
        "maxTries": 2,
        "waitBetweenTries": 2000,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "url": "=https://www.zohoapis.com/inventory/v1/packages",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "=organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              },
              {
                "name": "search_text",
                "value": "={{ $('Build JSON').item.json.doc_number }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          2928,
          368
        ],
        "id": "0ae581b6-d038-41f2-a6e7-a8c41bac503e",
        "name": "Get Package"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://www.zohoapis.com/inventory/v1/shipmentorders",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              },
              {
                "name": "salesorder_id",
                "value": "={{ $json.packages[0].salesorder_id }}"
              },
              {
                "name": "package_ids",
                "value": "={{ $json.packages[0].package_id }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"shipment_number\": \"{{ $('Build JSON').item.json.reference_number }}\",\n  \"date\": \"{{ $('Build JSON').item.json.date }}\",\n  \"delivery_method\": \"Takealot\",\n  \"tracking_number\": \"{{ $('Build JSON').item.json.reference_number }}\"\n} ",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          5200,
          240
        ],
        "id": "84e2f9c6-91b2-4ca6-b1aa-1ab285b2b1ae",
        "name": "Create Shipment",
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://www.zohoapis.com/inventory/v1/shipmentorders/{{ $json.shipmentorder.shipment_id }}/status/delivered",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          5600,
          256
        ],
        "id": "d4917ca1-51c5-4630-958c-c954508d2eb1",
        "name": "Mark as Delivered"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://www.zohoapis.com/inventory/v1/salesreturns",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              },
              {
                "name": "salesorder_id",
                "value": "={{ $('Get SO Details').item.json.salesorder.salesorder_id }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n    \"date\": \"{{ $('Build JSON').item.json.date }}\",\n    \"return_type\": \"return_credit\",\n    \"location_id\": \"{{ $('Get SO Details').item.json.salesorder.location_id }}\",\n    \"line_items\": [\n        {\n            \"item_id\": \"{{ $('Get SO Details').item.json.salesorder.line_items[0].item_id }}\",\n            \"salesorder_item_id\": \"{{ $('Get SO Details').item.json.salesorder.line_items[0].line_item_id }}\",\n            \"quantity\": {{ $('Build JSON').item.json.line_items[0].quantity }},\n            \"location_id\": \"{{ $('Build JSON').item.json.line_items[0].location_id }}\"\n        }\n    ]\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          4048,
          1776
        ],
        "id": "fe4f06f8-f8cc-4800-b122-85ec14082b3c",
        "name": "Create Sales Return"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://www.zohoapis.com/inventory/v1/salesreturnreceives",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              },
              {
                "name": "salesreturn_id",
                "value": "={{ $json.salesreturn.salesreturn_id }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n    \"date\": \"{{ $json.salesreturn.date }}\",\n    \"line_items\": [\n        {\n            \"line_item_id\": \"{{ $json.salesreturn.line_items[0].line_item_id }}\",\n            \"quantity\": {{ $json.salesreturn.line_items[0].quantity }}\n        }\n    ]\n} ",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          4272,
          1776
        ],
        "id": "66680dc4-1e04-44bc-8510-730943cf0196",
        "name": "Receive Sales Return",
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $('Webhook').item.json.body.sale.sale_status_id }}",
                      "rightValue": 2,
                      "operator": {
                        "type": "number",
                        "operation": "equals"
                      },
                      "id": "2bfe015f-886e-410e-a6fa-5f3c5c78f27e"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Preparing"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "9a4a839e-94a9-47e8-aeb3-7f54e02d9b9a",
                      "leftValue": "={{ $('Webhook').item.json.body.sale.sale_status_id }}",
                      "rightValue": 3,
                      "operator": {
                        "type": "number",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Shipped"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "c1b2e3aa-9b22-449e-9027-0483a4d7ba3f",
                      "leftValue": "={{ $('Webhook').item.json.body.sale.sale_status_id }}",
                      "rightValue": 19,
                      "operator": {
                        "type": "number",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Returned"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          2704,
          352
        ],
        "id": "67bd83cd-1721-4f03-9645-fc5dd5255d70",
        "name": "Switch1"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $('Set Endpoint').item.json.zoho_endpoint }}",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ $('Build JSON').item.json.toJsonString() }}",
          "options": {
            "response": {
              "response": {
                "fullResponse": true,
                "neverError": true,
                "responseFormat": "json"
              }
            }
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          3488,
          -256
        ],
        "id": "4865e69f-9e68-4106-9d45-bef3ffc12efd",
        "name": "Create Salesorder",
        "retryOnFail": true,
        "maxTries": 2,
        "waitBetweenTries": 2000,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $('Set Endpoint').item.json.zoho_endpoint }}",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ $('Build JSON').item.json.toJsonString() }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          6176,
          208
        ],
        "id": "909bcb86-660e-4120-9cf7-6770ef2159bb",
        "name": "Create Invoice"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $('Set Endpoint').item.json.zoho_endpoint }}",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ $('Build JSON').item.json.toJsonString() }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          4496,
          1776
        ],
        "id": "f3e281dc-3e61-4e91-8564-fed313c409d8",
        "name": "Create Credit Note"
      },
      {
        "parameters": {
          "url": "=https://www.zohoapis.com/inventory/v1/salesorders",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              },
              {
                "name": "search_text",
                "value": "={{ $json.reference_number }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          2864,
          1584
        ],
        "id": "0d226bf8-19fa-4be5-9ad9-04fef58a6f98",
        "name": "Get Original Sales Order Number",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "url": "=https://www.zohoapis.com/inventory/v1/salesorders/{{ $json.salesorders[0].salesorder_id }}",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          3376,
          1488
        ],
        "id": "8a9a8728-c201-4016-8ff9-0a1f720692fb",
        "name": "Get SO Details"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "d3418105-3246-4d2f-a5b4-a0c693f137d3",
                "leftValue": "={{ $json.salesorders }}",
                "rightValue": "",
                "operator": {
                  "type": "array",
                  "operation": "exists",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          3152,
          1584
        ],
        "id": "468a7244-2a8d-45e0-8411-a2104cb4e7c0",
        "name": "Found Original Sales Order"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          3376,
          1680
        ],
        "id": "2f140d0c-4e54-42d5-bfc3-6a2cbfc33159",
        "name": "No Operation, do nothing1"
      },
      {
        "parameters": {
          "url": "=https://www.zohoapis.com/inventory/v1/salesreturns",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              },
              {
                "name": "search_text",
                "value": "={{ $json.salesorder.salesorder_number }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n    \"date\": \"{{ $('Build JSON').item.json.date }}\",\n    \"location_id\": \"{{ $json.salesorder.location_id }}\",\n    \"line_items\": [\n        {\n            \"item_id\": \"{{ $json.salesorder.line_items[0].item_id }}\",\n            \"salesorder_item_id\": \"{{ $json.salesorder.line_items[0].line_item_id }}\",\n            \"quantity\": {{ $('Build JSON').item.json.line_items[0].quantity }},\n            \"location_id\": \"{{ $('Build JSON').item.json.line_items[0].location_id }}\"\n        }\n    ]\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          3600,
          1488
        ],
        "id": "a7c86499-84b5-48f0-adfc-3ecdce8f409f",
        "name": "Check for Existing SR"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "d442d061-0c45-4f91-8197-37b8d34e2cf4",
                "leftValue": "={{ $json.salesreturns.length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          3824,
          1488
        ],
        "id": "af670c31-9da6-40f4-808b-eb82c44f4559",
        "name": "SR Exists"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "d442d061-0c45-4f91-8197-37b8d34e2cf4",
                "leftValue": "={{ $json.salesreturns[0].quantity_yet_to_receive }}",
                "rightValue": -1,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          4048,
          1488
        ],
        "id": "bc8780ca-7b8c-48ea-8f55-7e1849d5b5d9",
        "name": "Available for return"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          4272,
          1584
        ],
        "id": "a28f0175-9702-4305-9f7e-6660f4906cfc",
        "name": "No Operation, do nothing2"
      },
      {
        "parameters": {
          "method": "PUT",
          "url": "=https://www.zohoapis.com/inventory/v1/salesreturns/{{ $json.salesreturns[0].salesreturn_id }}",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n    \"date\": \"{{ $('Build JSON').item.json.date }}\",\n    \"location_id\": \"{{ $json.salesorder.location_id }}\",\n    \"line_items\": [\n        {\n            \"item_id\": \"{{ $json.salesorder.line_items[0].item_id }}\",\n            \"salesorder_item_id\": \"{{ $json.salesorder.line_items[0].line_item_id }}\",\n            \"quantity\": {{ $('Build JSON').item.json.line_items[0].quantity }},\n            \"location_id\": \"{{ $('Build JSON').item.json.line_items[0].location_id }}\"\n        }\n    ]\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          4272,
          1424
        ],
        "id": "4029a5c9-4946-4254-9616-044f2dac24d3",
        "name": "Update SR"
      },
      {
        "parameters": {
          "content": "## Click [here](https://n8n.tallypro.co.za/form/commit?id=XYhKungDNJV46vQF) to commit change ",
          "height": 140,
          "width": 1224,
          "color": 5
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -528,
          240
        ],
        "typeVersion": 1,
        "id": "9f61b6de-7d67-4253-bd47-37b685aa75f7",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "url": "={{ $('Set Endpoint').item.json.zoho_endpoint }}",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              },
              {
                "name": "salesorder_number",
                "value": "={{ $('Build JSON').item.json.reference_number }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ $('Build JSON').item.json.toJsonString() }}",
          "options": {
            "response": {
              "response": {
                "fullResponse": true,
                "neverError": true,
                "responseFormat": "json"
              }
            }
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          3024,
          -336
        ],
        "id": "38f3fef2-5bff-49cc-a0ca-5b022977c81c",
        "name": "Check for Existing SO"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "e5eb83b5-8333-475a-8184-ddc2d334528d",
                "leftValue": "={{ $json.body.salesorders.length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          3232,
          -336
        ],
        "id": "ab7bba60-a5f9-4c01-a8d8-dc1da002fa75",
        "name": "SO Exists?"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "43a58f31-369b-4b21-8ed0-620bb3f52cac",
                "leftValue": "={{ $json.statusCode }}",
                "rightValue": 200,
                "operator": {
                  "type": "number",
                  "operation": "gte"
                }
              },
              {
                "id": "eca26688-5dd0-425f-8936-08a78e1c7e56",
                "leftValue": "={{ $json.statusCode }}",
                "rightValue": 299,
                "operator": {
                  "type": "number",
                  "operation": "lte"
                }
              },
              {
                "id": "335c6485-e0ad-4a9b-9de6-94b570f4c89c",
                "leftValue": "={{ $json.body.salesorder.salesorder_id }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                }
              },
              {
                "id": "df8a4a14-54b8-48a3-bf80-a5610815f6e2",
                "leftValue": "={{ $json.body.salesorder.line_items.length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          3760,
          -320
        ],
        "id": "65e6be3a-d72a-4ba1-9c77-918f343324d7",
        "name": "Validate SO Creation"
      },
      {
        "parameters": {
          "jsCode": "const response = $input.item.json.body.salesorder;\nconst expected = $('Build JSON').item.json;\n\n// Validate critical fields match\nconst errors = [];\n\nif (response.order_id !== expected.salesorder_id) {\n  errors.push(`Order ID mismatch: ${response.salesorder_id} vs ${expected.salesorder_id}`);\n}\n\nif (Math.abs(response.total - expected.line_items[0].item_total) > 0.01) {\n  errors.push(`Total mismatch: ${response.total} vs ${expected.line_items[0].item_total}`);\n}\n\nif (response.line_items[0].quantity !== expected.line_items[0].quantity) {\n  errors.push(`Quantity mismatch`);\n}\n\nif (errors.length > 0) {\n  throw new Error(`SO validation failed: ${errors.join(', ')}`);\n}\n\nreturn {\n  json: {\n    validated: true,\n    salesorder_id: response.salesorder_id,\n    ...response\n  }\n};"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          3984,
          -416
        ],
        "id": "f497d484-afaf-4aad-8cb1-651927f94374",
        "name": "Validate SO Data"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "d5bdf613-bb65-41cf-8d17-3ca871358eaa",
                "leftValue": "={{ $json.body.salesorder.line_items[0].quantity_packed }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "equals"
                }
              },
              {
                "id": "0f2d749c-be5a-43a7-81aa-aa7a7f900d44",
                "leftValue": "={{ $json.body.salesorder.status }}",
                "rightValue": "confirmed",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          4672,
          -592
        ],
        "id": "e44637fc-27a5-4155-9201-4e8208598740",
        "name": "Check Package Prerequisites"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.body.salesorders[0].order_status }}",
                      "rightValue": "void",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "2bfe015f-886e-410e-a6fa-5f3c5c78f27e"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "void"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "9a4a839e-94a9-47e8-aeb3-7f54e02d9b9a",
                      "leftValue": "={{ $json.body.salesorders[0].order_status }}",
                      "rightValue": "confirmed",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "confirmed"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "c1b2e3aa-9b22-449e-9027-0483a4d7ba3f",
                      "leftValue": "={{ $json.body.salesorders[0].order_status }}",
                      "rightValue": "draft",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "draft"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          3488,
          -496
        ],
        "id": "2f146bbb-9bee-4f71-83c2-ffa2be2f9232",
        "name": "Switch"
      },
      {
        "parameters": {
          "url": "={{ $('Set Endpoint').item.json.zoho_endpoint }}/{{ $('Validate SO Data').item.json.salesorder_id }}",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ $('Build JSON').item.json.toJsonString() }}",
          "options": {
            "response": {
              "response": {
                "fullResponse": true,
                "neverError": true,
                "responseFormat": "json"
              }
            }
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          4464,
          -528
        ],
        "id": "16ac7f23-b671-4e06-9b2d-1b4639106c83",
        "name": "Get Created SO"
      },
      {
        "parameters": {
          "url": "={{ $('Set Endpoint').item.json.zoho_endpoint }}/{{ $('Check for Existing SO').item.json.body.salesorders[0].salesorder_id }}",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "options": {
            "response": {
              "response": {
                "fullResponse": true,
                "neverError": true,
                "responseFormat": "json"
              }
            }
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          4464,
          -720
        ],
        "id": "3c43a92e-b3e2-4ff3-96ee-c27d84fb12b7",
        "name": "Get Existing SO"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                "name": "timestamp",
                "value": "={{ new Date().toISOString() }}",
                "type": "string"
              },
              {
                "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                "name": "execution_id",
                "value": "={{ $execution.id }}",
                "type": "string"
              },
              {
                "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                "name": "workflow_name",
                "value": "Takealot Status Change Webhook",
                "type": "string"
              },
              {
                "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                "name": "seller_id",
                "value": "={{ $('Webhook').item.json.params.seller_id }}",
                "type": "string"
              },
              {
                "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                "name": "order_item_id",
                "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                "type": "string"
              },
              {
                "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                "name": "stage",
                "value": "create_so",
                "type": "string"
              },
              {
                "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                "name": "status",
                "value": "error",
                "type": "string"
              },
              {
                "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                "name": "message",
                "value": "Sales Order creation failed",
                "type": "string"
              },
              {
                "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                "name": "details",
                "value": "={{ $('Webhook').item.json.toJsonString() }}",
                "type": "object"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          3952,
          -128
        ],
        "id": "1e614a3c-48e5-48f6-8e7b-fb9ed139da97",
        "name": "Log Entry - Failed SO Create"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                "name": "timestamp",
                "value": "={{ new Date().toISOString() }}",
                "type": "string"
              },
              {
                "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                "name": "execution_id",
                "value": "={{ $execution.id }}",
                "type": "string"
              },
              {
                "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                "name": "workflow_name",
                "value": "Takealot Status Change Webhook",
                "type": "string"
              },
              {
                "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                "name": "seller_id",
                "value": "={{ $('Webhook').item.json.params.seller_id }}",
                "type": "string"
              },
              {
                "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                "name": "order_item_id",
                "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                "type": "string"
              },
              {
                "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                "name": "stage",
                "value": "confirm_so",
                "type": "string"
              },
              {
                "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                "name": "status",
                "value": "error",
                "type": "string"
              },
              {
                "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                "name": "message",
                "value": "Sales Order confirmation failed",
                "type": "string"
              },
              {
                "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                "name": "details",
                "value": "={{ $('Webhook').item.json.toJsonString() }}",
                "type": "object"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          4496,
          -336
        ],
        "id": "733c646d-82f1-4444-8fb3-89c974ddd0aa",
        "name": "Log Entry - SO Confirm Fail"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                "name": "timestamp",
                "value": "={{ new Date().toISOString() }}",
                "type": "string"
              },
              {
                "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                "name": "execution_id",
                "value": "={{ $execution.id }}",
                "type": "string"
              },
              {
                "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                "name": "workflow_name",
                "value": "Takealot Status Change Webhook",
                "type": "string"
              },
              {
                "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                "name": "seller_id",
                "value": "={{ $('Webhook').item.json.params.seller_id }}",
                "type": "string"
              },
              {
                "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                "name": "order_item_id",
                "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                "type": "string"
              },
              {
                "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                "name": "stage",
                "value": "package_check",
                "type": "string"
              },
              {
                "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                "name": "status",
                "value": "error",
                "type": "string"
              },
              {
                "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                "name": "message",
                "value": "Package Prerequisites Failed",
                "type": "string"
              },
              {
                "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                "name": "details",
                "value": "={{ $('Webhook').item.json.toJsonString() }}",
                "type": "object"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          4928,
          -464
        ],
        "id": "104e58b1-0392-4fb9-b4e3-d9fbf69f2b15",
        "name": "Log Entry - Package Prerequisites failed"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                "name": "timestamp",
                "value": "={{ new Date().toISOString() }}",
                "type": "string"
              },
              {
                "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                "name": "execution_id",
                "value": "={{ $execution.id }}",
                "type": "string"
              },
              {
                "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                "name": "workflow_name",
                "value": "Takealot Status Change Webhook",
                "type": "string"
              },
              {
                "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                "name": "seller_id",
                "value": "={{ $('Webhook').item.json.params.seller_id }}",
                "type": "string"
              },
              {
                "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                "name": "order_item_id",
                "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                "type": "string"
              },
              {
                "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                "name": "stage",
                "value": "validate_so",
                "type": "string"
              },
              {
                "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                "name": "status",
                "value": "error",
                "type": "string"
              },
              {
                "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                "name": "message",
                "value": "Sales Order invalid",
                "type": "string"
              },
              {
                "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                "name": "details",
                "value": "={{ $('Webhook').item.json.toJsonString() }}",
                "type": "object"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          4160,
          -240
        ],
        "id": "0e21a2ab-1f0d-49e6-a936-1c9e0bcffeac",
        "name": "Log Entry - Invalid SO"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                "name": "timestamp",
                "value": "={{ new Date().toISOString() }}",
                "type": "string"
              },
              {
                "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                "name": "execution_id",
                "value": "={{ $execution.id }}",
                "type": "string"
              },
              {
                "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                "name": "workflow_name",
                "value": "Takealot Status Change Webhook",
                "type": "string"
              },
              {
                "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                "name": "seller_id",
                "value": "={{ $('Webhook').item.json.params.seller_id }}",
                "type": "string"
              },
              {
                "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                "name": "order_item_id",
                "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                "type": "string"
              },
              {
                "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                "name": "stage",
                "value": "void_so",
                "type": "string"
              },
              {
                "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                "name": "status",
                "value": "error",
                "type": "string"
              },
              {
                "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                "name": "message",
                "value": "Sales Order exists in status VOID",
                "type": "string"
              },
              {
                "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                "name": "details",
                "value": "={{ $('Webhook').item.json.toJsonString() }}",
                "type": "object"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          3680,
          -688
        ],
        "id": "9c9d6f02-6e27-4fdb-ad75-c998b96beac4",
        "name": "Log Entry - SO = Void"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                "name": "timestamp",
                "value": "={{ new Date().toISOString() }}",
                "type": "string"
              },
              {
                "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                "name": "execution_id",
                "value": "={{ $execution.id }}",
                "type": "string"
              },
              {
                "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                "name": "workflow_name",
                "value": "Takealot Status Change Webhook",
                "type": "string"
              },
              {
                "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                "name": "seller_id",
                "value": "={{ $('Webhook').item.json.params.seller_id }}",
                "type": "string"
              },
              {
                "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                "name": "order_item_id",
                "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                "type": "string"
              },
              {
                "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                "name": "stage",
                "value": "package_create",
                "type": "string"
              },
              {
                "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                "name": "status",
                "value": "error",
                "type": "string"
              },
              {
                "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                "name": "message",
                "value": "Package Create Failed",
                "type": "string"
              },
              {
                "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                "name": "details",
                "value": "={{ $('Webhook').item.json.toJsonString() }}",
                "type": "object"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          5136,
          -624
        ],
        "id": "9afc2845-9d12-41f0-92e5-f009ed90bdcd",
        "name": "Log Entry - Create Package failed"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                "name": "timestamp",
                "value": "={{ new Date().toISOString() }}",
                "type": "string"
              },
              {
                "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                "name": "execution_id",
                "value": "={{ $execution.id }}",
                "type": "string"
              },
              {
                "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                "name": "workflow_name",
                "value": "Takealot Status Change Webhook",
                "type": "string"
              },
              {
                "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                "name": "seller_id",
                "value": "={{ $('Webhook').item.json.params.seller_id }}",
                "type": "string"
              },
              {
                "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                "name": "order_item_id",
                "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                "type": "string"
              },
              {
                "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                "name": "stage",
                "value": "so_workflow",
                "type": "string"
              },
              {
                "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                "name": "status",
                "value": "success",
                "type": "string"
              },
              {
                "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                "name": "message",
                "value": "Salesorder workflow completed successfully",
                "type": "string"
              },
              {
                "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                "name": "details",
                "value": "={{ $('Webhook').item.json.toJsonString() }}",
                "type": "object"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          5152,
          -816
        ],
        "id": "4616373a-f409-4da9-a2a3-7ff658ca3b93",
        "name": "Log Entry - Success"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://urbanetrains.backendless.app/api/data/n8n-status-change-webhook-workflow-logs",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ $json }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          5584,
          -272
        ],
        "id": "008e76ba-56f5-4546-8302-500be80a254d",
        "name": "Log Result to Backendless"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://urbanetrains.backendless.app/api/data/n8n-status-change-webhook-workflow-logs",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ $json }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          3856,
          -688
        ],
        "id": "2e2c2aff-7590-4113-b5cb-e4792d68cfc7",
        "name": "Log Event to Backendless"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "76b9b3c3-dc42-4b56-bbf0-0597eb51f0db",
                "leftValue": "={{ $json.packages }}",
                "rightValue": "",
                "operator": {
                  "type": "array",
                  "operation": "exists",
                  "singleValue": true
                }
              },
              {
                "id": "0471f1e8-acdf-4e45-8444-7864bff5acf5",
                "leftValue": "={{ $json.packages.length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          3136,
          368
        ],
        "id": "02e0b3d9-b0e0-40b8-a03f-fb4d12fb2066",
        "name": "Does Package Exist?"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "6e609447-105e-4d44-bb7c-c5e5d3f0a814",
                "leftValue": "={{ $json.packages[0].shipment_id }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          4944,
          160
        ],
        "id": "9556bb66-3043-4610-9c2e-e2ef5eeba0b3",
        "name": "Shipment Exists?"
      },
      {
        "parameters": {
          "url": "=https://www.zohoapis.com/inventory/v1/shipmentorders/{{ $json.packages[0].shipment_id }}",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          5200,
          64
        ],
        "id": "8dd1c10f-d1d6-4db0-9a4e-049993140cfa",
        "name": "Get Shipment",
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "ea4e921e-d36f-4924-b2a0-c3cda01edc1f",
                "leftValue": "={{ $json.shipmentorder.shipment_status }}",
                "rightValue": "delivered",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          5392,
          160
        ],
        "id": "496286c7-3a20-46b7-bc0d-af89ca748e0e",
        "name": "Is Shipment Delivered?"
      },
      {
        "parameters": {
          "url": "=https://www.zohoapis.com/inventory/v1/invoices",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              },
              {
                "name": "reference_number",
                "value": "={{ $('Build JSON').item.json.reference_number }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          5760,
          112
        ],
        "id": "a7140acf-f907-4460-a8d6-3ee011e10c0a",
        "name": "Get Invoices",
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "f4b81d75-0bc3-4522-a63f-a59ab360ab14",
                "leftValue": "={{ $json.invoices }}",
                "rightValue": "",
                "operator": {
                  "type": "array",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          5952,
          112
        ],
        "id": "4e28249e-11fb-42d6-8399-f0e15b1f213b",
        "name": "Invoice Exists?"
      },
      {
        "parameters": {
          "url": "=https://www.zohoapis.com/inventory/v1/invoices/{{ $json.invoices[0].invoice_id }}",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              },
              {
                "name": "reference_number",
                "value": "={{ $('Build JSON').item.json.reference_number }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          6176,
          32
        ],
        "id": "6813f473-3c57-45b4-bf2f-8790151ee0c1",
        "name": "Get Invoice",
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "5ae8b968-ab68-43a5-aa4b-0bbfa593b95a",
                "name": "invoice_id",
                "value": "={{ $json.invoice.invoice_id }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          6352,
          112
        ],
        "id": "2af26e17-2f69-4f78-8328-965fbce2daae",
        "name": "Extract invoice_id"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://n8n.tallypro.co.za/webhook/fa329524-5a4e-4fab-a636-cfcd3b496f4b/{{ $('Webhook').item.json.params.seller_id }}",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "x-takealot-event",
                "value": "sale_status_changed"
              },
              {
                "name": "x-n8n-self-heal",
                "value": "true"
              },
              {
                "name": "x-n8n-retry-count",
                "value": "={{ ($('Webhook').item.json.headers['x-n8n-retry-count'] ? parseInt($('Webhook').item.json.headers['x-n8n-retry-count']) : 0) + 1 }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify({\n  sale: {\n    order_item_id: $('Webhook').item.json.body.sale.order_item_id,\n    offer_id: $('Webhook').item.json.body.sale.offer_id,\n    order_id: $('Webhook').item.json.body.sale.order_id,\n    warehouse: $('Webhook').item.json.body.sale.warehouse,\n    warehouse_id: $('Webhook').item.json.body.sale.warehouse_id,\n    sale_status_id: 2,\n    sale_status: 'Preparing for Customer',\n    order_date: $('Webhook').item.json.body.sale.order_date,\n    product_title: $('Webhook').item.json.body.sale.product_title,\n    takealot_url_mobi: $('Webhook').item.json.body.sale.takealot_url_mobi,\n    sku: $('Webhook').item.json.body.sale.sku,\n    tsin: $('Webhook').item.json.body.sale.tsin,\n    quantity: $('Webhook').item.json.body.sale.quantity,\n    selling_price: $('Webhook').item.json.body.sale.selling_price,\n    customer: $('Webhook').item.json.body.sale.customer,\n    customer_warehouse: $('Webhook').item.json.body.sale.customer_warehouse\n  },\n  event_timestamp_utc: $('Webhook').item.json.body.event_timestamp_utc\n}) }}",
          "options": {
            "response": {
              "response": {
                "fullResponse": true,
                "neverError": true
              }
            },
            "timeout": 30000
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          3488,
          672
        ],
        "id": "a618e5c0-d9a9-4d6a-b923-9af3d08a4506",
        "name": "Recursive call"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          3888,
          608
        ],
        "id": "95440ee9-3f8a-44c8-adaf-7454f735350d",
        "name": "Wait 5 sec",
        "webhookId": "5930ab40-b44d-49ac-a930-83ec5e5eac09"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                "name": "timestamp",
                "value": "={{ new Date().toISOString() }}",
                "type": "string"
              },
              {
                "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                "name": "execution_id",
                "value": "={{ $execution.id }}",
                "type": "string"
              },
              {
                "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                "name": "workflow_name",
                "value": "Takealot Status Change Webhook",
                "type": "string"
              },
              {
                "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                "name": "seller_id",
                "value": "={{ $('Webhook').item.json.params.seller_id }}",
                "type": "string"
              },
              {
                "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                "name": "order_item_id",
                "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                "type": "string"
              },
              {
                "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                "name": "stage",
                "value": "No Package",
                "type": "string"
              },
              {
                "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                "name": "status",
                "value": "self-heal",
                "type": "string"
              },
              {
                "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                "name": "message",
                "value": "Attempting self-heal",
                "type": "string"
              },
              {
                "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                "name": "details",
                "value": "={{ $('Webhook').item.json.toJsonString() }}",
                "type": "object"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          3104,
          624
        ],
        "id": "26f443f3-ca56-40cb-9204-8da336c6bf7f",
        "name": "Log Entry - Self-Heal start"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://urbanetrains.backendless.app/api/data/n8n-status-change-webhook-workflow-logs",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ $json }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          3264,
          624
        ],
        "id": "1878cd5e-e271-44b3-a1e4-e9587fb5f56f",
        "name": "Log status to Backendless"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                "name": "timestamp",
                "value": "={{ new Date().toISOString() }}",
                "type": "string"
              },
              {
                "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                "name": "execution_id",
                "value": "={{ $execution.id }}",
                "type": "string"
              },
              {
                "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                "name": "workflow_name",
                "value": "Takealot Status Change Webhook",
                "type": "string"
              },
              {
                "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                "name": "seller_id",
                "value": "={{ $('Webhook').item.json.params.seller_id }}",
                "type": "string"
              },
              {
                "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                "name": "order_item_id",
                "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                "type": "string"
              },
              {
                "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                "name": "stage",
                "value": "create_so",
                "type": "string"
              },
              {
                "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                "name": "status",
                "value": "error",
                "type": "string"
              },
              {
                "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                "name": "message",
                "value": "Self-heal failed",
                "type": "string"
              },
              {
                "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                "name": "details",
                "value": "={{ $('Webhook').item.json.toJsonString() }}",
                "type": "object"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          3632,
          416
        ],
        "id": "eb854239-1f5b-4615-9180-79642a916da7",
        "name": "Log Entry - Failed Recursion"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://urbanetrains.backendless.app/api/data/n8n-status-change-webhook-workflow-logs",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ $json }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          3808,
          416
        ],
        "id": "30150c74-ca61-42ca-a57d-088a1201dae3",
        "name": "Log Recursion fail to Backendless"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "e4d97c1f-6562-4117-945b-a6ff0b4e2131",
                "leftValue": "={{ parseInt($('Webhook').item.json.headers['x-n8n-retry-count'] || '0') }}",
                "rightValue": 2,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          3408,
          448
        ],
        "id": "03aac066-e2d6-446f-bd68-dd074e9b9afa",
        "name": "Prevent infinite loop"
      },
      {
        "parameters": {
          "url": "=https://www.zohoapis.com/inventory/v1/packages",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "=organization_id",
                "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
              },
              {
                "name": "search_text",
                "value": "={{ $('Build JSON').item.json.doc_number }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          4096,
          576
        ],
        "id": "3ac6a3e6-2a6c-40a1-9cff-421af5bdd1da",
        "name": "Get Package1"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://urbanetrains.backendless.app/api/data/n8n-status-change-webhook-workflow-logs",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ $json }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          4752,
          448
        ],
        "id": "320b4b3c-3f50-4c24-ad12-41e457da22e9",
        "name": "Log result"
      },
      {
        "parameters": {
          "url": "=https://httpbin.dev/base64/encode/{{ encodeURIComponent($json.HMAC) }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          1056,
          464
        ],
        "id": "d6f1dc40-bbde-4160-b00f-f45ae88ee304",
        "name": "HTTP Request"
      },
      {
        "parameters": {
          "action": "hmac",
          "binaryData": true,
          "binaryPropertyName": "={{ $('Merge').item.binary.data }}",
          "type": "SHA256",
          "dataPropertyName": "HMAC",
          "secret": "={{ $json.takealot_webhook_secret }}"
        },
        "type": "n8n-nodes-base.crypto",
        "typeVersion": 1,
        "position": [
          768,
          464
        ],
        "id": "e2234e8e-9921-49bd-9c16-b12e02edb77b",
        "name": "Crypto"
      },
      {
        "parameters": {
          "mode": "combine",
          "combineBy": "combineByPosition",
          "options": {}
        },
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.2,
        "position": [
          496,
          592
        ],
        "id": "e0e55edd-6656-4cd1-b86f-e3b0b359929d",
        "name": "Merge"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "22b3ebc9-54ae-4669-9b5b-5694dba9bf0a",
                "leftValue": "={{ $json.data }}",
                "rightValue": "={{ $('Webhook').item.json.headers['x-takealot-signature'] }}",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          1264,
          464
        ],
        "id": "9d89f32f-7932-41c1-a364-6a00b1785e60",
        "name": "Check HMAC"
      },
      {
        "parameters": {
          "operation": "toText",
          "sourceProperty": "=data",
          "options": {}
        },
        "type": "n8n-nodes-base.convertToFile",
        "typeVersion": 1.1,
        "position": [
          160,
          576
        ],
        "id": "36f5be25-010b-462c-b264-bf18e4f34ffe",
        "name": "Convert to File"
      },
      {
        "parameters": {
          "mode": "raw",
          "jsonOutput": "={{ { \"data\": \"https://n8n.tallypro.co.za/webhook/fa329524-5a4e-4fab-a636-cfcd3b496f4b/\" + $('Webhook').item.json.params.seller_id + JSON.stringify($('Webhook').item.json.body).split('\":').join('\": ').split(',\"').join(', \"').split(':{').join(': {').split('},').join('},') } }}",
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -64,
          576
        ],
        "id": "5ad7d4e9-c725-4271-9cf0-202596bbe3db",
        "name": "Edit Fields"
      },
      {
        "parameters": {
          "operation": "fromJson",
          "options": {}
        },
        "type": "n8n-nodes-base.extractFromFile",
        "typeVersion": 1.1,
        "position": [
          -288,
          576
        ],
        "id": "953db65f-857b-43a2-a16c-4f434c1fad55",
        "name": "Extract from File",
        "disabled": true
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                "name": "timestamp",
                "value": "={{ new Date().toISOString() }}",
                "type": "string"
              },
              {
                "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                "name": "execution_id",
                "value": "={{ $execution.id }}",
                "type": "string"
              },
              {
                "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                "name": "workflow_name",
                "value": "Takealot Status Change Webhook",
                "type": "string"
              },
              {
                "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                "name": "seller_id",
                "value": "={{ $('Webhook').item.json.params.seller_id }}",
                "type": "string"
              },
              {
                "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                "name": "order_item_id",
                "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                "type": "string"
              },
              {
                "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                "name": "stage",
                "value": "hmac_verify",
                "type": "string"
              },
              {
                "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                "name": "status",
                "value": "error",
                "type": "string"
              },
              {
                "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                "name": "message",
                "value": "HMAC signature does not match",
                "type": "string"
              },
              {
                "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                "name": "details",
                "value": "={{ $('Webhook').item.json.toJsonString() }}",
                "type": "object"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1248,
          736
        ],
        "id": "23aa6ae0-9c3a-4f31-adfc-c81cce5e19c4",
        "name": "Log Entry - SO = Void1"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://urbanetrains.backendless.app/api/data/n8n-status-change-webhook-workflow-logs",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ $json }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          1424,
          736
        ],
        "id": "abc760fd-2422-4556-b04e-5dfc219643cf",
        "name": "Log HMAC failure"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "30bbedd7-b6cd-4b64-b74f-fccebfd37345",
                "leftValue": "={{ $json.statusCode }}",
                "rightValue": 200,
                "operator": {
                  "type": "number",
                  "operation": "gte"
                }
              },
              {
                "id": "4682e40e-606c-4aeb-812f-ae0cf3b4ca4f",
                "leftValue": "={{ $json.statusCode }}",
                "rightValue": 299,
                "operator": {
                  "type": "number",
                  "operation": "gte"
                }
              }
            ],
            "combinator": "or"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          3664,
          672
        ],
        "id": "09409971-2188-4b37-858a-e70982de3fb6",
        "name": "Successful Request"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                "name": "timestamp",
                "value": "={{ new Date().toISOString() }}",
                "type": "string"
              },
              {
                "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                "name": "execution_id",
                "value": "={{ $execution.id }}",
                "type": "string"
              },
              {
                "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                "name": "workflow_name",
                "value": "Takealot Status Change Webhook",
                "type": "string"
              },
              {
                "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                "name": "seller_id",
                "value": "={{ $('Webhook').item.json.params.seller_id }}",
                "type": "string"
              },
              {
                "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                "name": "order_item_id",
                "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                "type": "string"
              },
              {
                "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                "name": "stage",
                "value": "Recursive request",
                "type": "string"
              },
              {
                "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                "name": "status",
                "value": "self-heal",
                "type": "string"
              },
              {
                "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                "name": "message",
                "value": "Recursive request bad response",
                "type": "string"
              },
              {
                "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                "name": "details",
                "value": "={{ $('Webhook').item.json.toJsonString() }}",
                "type": "object"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          3888,
          816
        ],
        "id": "f744b335-f2ae-413d-b437-d9a24889cae3",
        "name": "Log Entry - Bad request"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://urbanetrains.backendless.app/api/data/n8n-status-change-webhook-workflow-logs",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ $json }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          4048,
          816
        ],
        "id": "c9f51758-b518-4040-b38b-3724e4c92907",
        "name": "Log bad request"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "76b9b3c3-dc42-4b56-bbf0-0597eb51f0db",
                "leftValue": "={{ $json.packages }}",
                "rightValue": "",
                "operator": {
                  "type": "array",
                  "operation": "exists",
                  "singleValue": true
                }
              },
              {
                "id": "0471f1e8-acdf-4e45-8444-7864bff5acf5",
                "leftValue": "={{ $json.packages.length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          4320,
          368
        ],
        "id": "b041bee5-366d-414e-9f3c-275e82fe4e29",
        "name": "Has self heal worked?"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                "name": "timestamp",
                "value": "={{ new Date().toISOString() }}",
                "type": "string"
              },
              {
                "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                "name": "execution_id",
                "value": "={{ $execution.id }}",
                "type": "string"
              },
              {
                "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                "name": "workflow_name",
                "value": "Takealot Status Change Webhook",
                "type": "string"
              },
              {
                "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                "name": "seller_id",
                "value": "={{ $('Webhook').item.json.params.seller_id }}",
                "type": "string"
              },
              {
                "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                "name": "order_item_id",
                "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                "type": "string"
              },
              {
                "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                "name": "stage",
                "value": "Recursion",
                "type": "string"
              },
              {
                "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                "name": "status",
                "value": "error",
                "type": "string"
              },
              {
                "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                "name": "message",
                "value": "Self Heal failed",
                "type": "string"
              },
              {
                "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                "name": "details",
                "value": "={{ $('Webhook').item.json.toJsonString() }}",
                "type": "object"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          4544,
          448
        ],
        "id": "e58ad088-1b71-4bd2-b3d4-d584a36ed223",
        "name": "Log Entry - Self-Heal fail"
      }
    ],
    "connections": {
      "Webhook": {
        "main": [
          [
            {
              "node": "Get row(s)",
              "type": "main",
              "index": 0
            },
            {
              "node": "Extract from File",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Zoho Access Token": {
        "main": [
          [
            {
              "node": "Get Item ID from SKU",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Item ID from SKU": {
        "main": [
          [
            {
              "node": "Build JSON",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Endpoint": {
        "main": [
          [
            {
              "node": "if valid transaction",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Build JSON": {
        "main": [
          [
            {
              "node": "Switch1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Mark Invoice as Sent": {
        "main": [
          [
            {
              "node": "Map to Salesorder",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get row(s)": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "if valid transaction": {
        "main": [
          [
            {
              "node": "Get Zoho Access Token",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "No Operation, do nothing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Confirm Salesorder": {
        "main": [
          [
            {
              "node": "Get Created SO",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Entry - SO Confirm Fail",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Package": {
        "main": [
          [
            {
              "node": "Does Package Exist?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Shipment": {
        "main": [
          [
            {
              "node": "Is Shipment Delivered?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Mark as Delivered": {
        "main": [
          [
            {
              "node": "Get Invoices",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Sales Return": {
        "main": [
          [
            {
              "node": "Receive Sales Return",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch1": {
        "main": [
          [
            {
              "node": "Check for Existing SO",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Get Package",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Get Original Sales Order Number",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Salesorder": {
        "main": [
          [
            {
              "node": "Validate SO Creation",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Entry - Failed SO Create",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Invoice": {
        "main": [
          [
            {
              "node": "Extract invoice_id",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Receive Sales Return": {
        "main": [
          [
            {
              "node": "Create Credit Note",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Original Sales Order Number": {
        "main": [
          [
            {
              "node": "Found Original Sales Order",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get SO Details": {
        "main": [
          [
            {
              "node": "Check for Existing SR",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Found Original Sales Order": {
        "main": [
          [
            {
              "node": "Get SO Details",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "No Operation, do nothing1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check for Existing SR": {
        "main": [
          [
            {
              "node": "SR Exists",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "SR Exists": {
        "main": [
          [
            {
              "node": "Available for return",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Create Sales Return",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Available for return": {
        "main": [
          [
            {
              "node": "Update SR",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "No Operation, do nothing2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check for Existing SO": {
        "main": [
          [
            {
              "node": "SO Exists?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "SO Exists?": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Create Salesorder",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Validate SO Creation": {
        "main": [
          [
            {
              "node": "Validate SO Data",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Entry - Invalid SO",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Validate SO Data": {
        "main": [
          [
            {
              "node": "Confirm Salesorder",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Package Prerequisites": {
        "main": [
          [
            {
              "node": "Create package",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Entry - Package Prerequisites failed",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create package": {
        "main": [
          [
            {
              "node": "Log Entry - Success",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Entry - Create Package failed",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Log Entry - SO = Void",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Get Existing SO",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Validate SO Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Created SO": {
        "main": [
          [
            {
              "node": "Check Package Prerequisites",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Existing SO": {
        "main": [
          [
            {
              "node": "Check Package Prerequisites",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Entry - Package Prerequisites failed": {
        "main": [
          [
            {
              "node": "Log Result to Backendless",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Entry - Success": {
        "main": [
          [
            {
              "node": "Log Result to Backendless",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Entry - Create Package failed": {
        "main": [
          [
            {
              "node": "Log Result to Backendless",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Entry - SO Confirm Fail": {
        "main": [
          [
            {
              "node": "Log Result to Backendless",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Entry - Invalid SO": {
        "main": [
          [
            {
              "node": "Log Result to Backendless",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Entry - Failed SO Create": {
        "main": [
          [
            {
              "node": "Log Result to Backendless",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Entry - SO = Void": {
        "main": [
          [
            {
              "node": "Log Event to Backendless",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Does Package Exist?": {
        "main": [
          [
            {
              "node": "Shipment Exists?",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Entry - Self-Heal start",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Shipment Exists?": {
        "main": [
          [
            {
              "node": "Get Shipment",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Create Shipment",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is Shipment Delivered?": {
        "main": [
          [
            {
              "node": "Get Invoices",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Mark as Delivered",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Shipment": {
        "main": [
          [
            {
              "node": "Is Shipment Delivered?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Invoices": {
        "main": [
          [
            {
              "node": "Invoice Exists?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Invoice Exists?": {
        "main": [
          [
            {
              "node": "Get Invoice",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Create Invoice",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Invoice": {
        "main": [
          [
            {
              "node": "Extract invoice_id",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract invoice_id": {
        "main": [
          [
            {
              "node": "Mark Invoice as Sent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Recursive call": {
        "main": [
          [
            {
              "node": "Successful Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Entry - Self-Heal start": {
        "main": [
          [
            {
              "node": "Log status to Backendless",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log status to Backendless": {
        "main": [
          [
            {
              "node": "Prevent infinite loop",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Entry - Failed Recursion": {
        "main": [
          [
            {
              "node": "Log Recursion fail to Backendless",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prevent infinite loop": {
        "main": [
          [
            {
              "node": "Log Entry - Failed Recursion",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Recursive call",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait 5 sec": {
        "main": [
          [
            {
              "node": "Get Package1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Package1": {
        "main": [
          [
            {
              "node": "Has self heal worked?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request": {
        "main": [
          [
            {
              "node": "Check HMAC",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Crypto": {
        "main": [
          [
            {
              "node": "HTTP Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge": {
        "main": [
          [
            {
              "node": "Crypto",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check HMAC": {
        "main": [
          [
            {
              "node": "Set Endpoint",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Entry - SO = Void1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convert to File": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Edit Fields": {
        "main": [
          [
            {
              "node": "Convert to File",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract from File": {
        "main": [
          [
            {
              "node": "Edit Fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Entry - SO = Void1": {
        "main": [
          [
            {
              "node": "Log HMAC failure",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log HMAC failure": {
        "main": [
          [
            {
              "node": "Set Endpoint",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log result": {
        "main": [
          []
        ]
      },
      "Successful Request": {
        "main": [
          [
            {
              "node": "Wait 5 sec",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Entry - Bad request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Entry - Bad request": {
        "main": [
          [
            {
              "node": "Log bad request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Has self heal worked?": {
        "main": [
          [
            {
              "node": "Shipment Exists?",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Entry - Self-Heal fail",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Entry - Self-Heal fail": {
        "main": [
          [
            {
              "node": "Log result",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1",
      "availableInMCP": false
    },
    "staticData": null,
    "meta": null,
    "pinData": {},
    "versionId": "888123ae-30c6-4d4b-92c7-19c812041d1c",
    "activeVersionId": "888123ae-30c6-4d4b-92c7-19c812041d1c",
    "versionCounter": 279,
    "triggerCount": 1,
    "shared": [
      {
        "updatedAt": "2026-01-01T15:28:55.930Z",
        "createdAt": "2026-01-01T15:28:55.930Z",
        "role": "workflow:owner",
        "workflowId": "XYhKungDNJV46vQF",
        "projectId": "A2rkQg960Oa5Tvrh",
        "project": {
          "updatedAt": "2025-12-31T14:13:45.374Z",
          "createdAt": "2025-12-31T14:10:14.084Z",
          "id": "A2rkQg960Oa5Tvrh",
          "name": "Mark Wilson <mark@tallypro.co.za>",
          "type": "personal",
          "icon": null,
          "description": null,
          "creatorId": "cb6b4be4-4f57-4999-b61c-7cb9ecfa4a89",
          "projectRelations": [
            {
              "updatedAt": "2025-12-31T14:10:14.084Z",
              "createdAt": "2025-12-31T14:10:14.084Z",
              "userId": "cb6b4be4-4f57-4999-b61c-7cb9ecfa4a89",
              "projectId": "A2rkQg960Oa5Tvrh",
              "user": {
                "updatedAt": "2026-02-04T06:49:45.000Z",
                "createdAt": "2025-12-31T14:10:08.854Z",
                "id": "cb6b4be4-4f57-4999-b61c-7cb9ecfa4a89",
                "email": "mark@tallypro.co.za",
                "firstName": "Mark",
                "lastName": "Wilson",
                "personalizationAnswers": {
                  "version": "v4",
                  "personalization_survey_submitted_at": "2025-12-31T14:14:09.155Z",
                  "personalization_survey_n8n_version": "2.1.4",
                  "companyType": "personal",
                  "reportedSource": "youtube"
                },
                "settings": {
                  "userActivated": true,
                  "firstSuccessfulWorkflowId": "XYhKungDNJV46vQF",
                  "userActivatedAt": 1767342699529,
                  "npsSurvey": {
                    "responded": true,
                    "lastShownAt": 1768308412140
                  }
                },
                "disabled": false,
                "mfaEnabled": false,
                "lastActiveAt": "2026-02-03",
                "isPending": false
              }
            }
          ]
        }
      }
    ],
    "tags": [],
    "activeVersion": {
      "updatedAt": "2026-02-04T15:12:57.000Z",
      "createdAt": "2026-02-04T15:12:54.530Z",
      "versionId": "888123ae-30c6-4d4b-92c7-19c812041d1c",
      "workflowId": "XYhKungDNJV46vQF",
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": ":seller_id",
            "options": {
              "rawBody": true
            }
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -528,
            464
          ],
          "id": "fd6cf5b0-c95c-48ad-be0e-cc46d02762ec",
          "name": "Webhook",
          "webhookId": "fa329524-5a4e-4fab-a636-cfcd3b496f4b"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://accounts.zoho.com/oauth/v2/token",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpCustomAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            2016,
            368
          ],
          "id": "357e44a9-f2f4-4ec2-9f49-98a4a12e46dc",
          "name": "Get Zoho Access Token",
          "credentials": {
            "httpCustomAuth": {
              "id": "9SvOEsYF9SjtHbhQ",
              "name": "Zoho_Access_Token"
            }
          }
        },
        {
          "parameters": {
            "url": "https://www.zohoapis.com/inventory/v1/items",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                },
                {
                  "name": "search_text",
                  "value": "={{ $('Webhook').item.json.body.sale.sku.substring(0, 4) }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $json.access_token }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            2240,
            368
          ],
          "id": "b17cc03e-80a5-438e-a669-8bf82b27a4e8",
          "name": "Get Item ID from SKU"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Set Endpoint').item.json.zoho_endpoint }}/{{ $json.salesorder_id }}/status/confirmed",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            4240,
            -416
          ],
          "id": "65ea9213-8821-474b-b8a6-0533fc805532",
          "name": "Confirm Salesorder",
          "retryOnFail": true,
          "maxTries": 2,
          "waitBetweenTries": 2000,
          "onError": "continueErrorOutput"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "4841da88-677c-4093-9e86-9a06ac2a6f83",
                  "name": "zoho_endpoint",
                  "value": "={{ ({\n  2: \"https://www.zohoapis.com/inventory/v1/salesorders\",\n  3: \"https://www.zohoapis.com/inventory/v1/invoices\",\n  19: \"https://www.zohoapis.com/inventory/v1/creditnotes\"\n})[$('Webhook').item.json.body.sale.sale_status_id] || null }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1568,
            464
          ],
          "id": "b2c36f0d-80be-4c33-97b8-128c72e7ea10",
          "name": "Set Endpoint"
        },
        {
          "parameters": {
            "mode": "raw",
            "jsonOutput": "={\n  \"customer_id\": \"{{ $('Get row(s)').item.json.CustomerID }}\",\n\"date\": \"{{ (() => {\n  const date = $('Webhook').item.json.body.event_timestamp_utc.split('T')[0];\n  if (!/^\\d{4}-\\d{2}-\\d{2}$/.test(date)) {\n    throw new Error('Invalid date format');\n  }\n  return date;\n})() }}\",\n  \"doc_number\": \"{{ $('Webhook').item.json.body.sale.order_item_id }}(Order: {{ $('Webhook').item.json.body.sale.order_id }})\",\n  \"order_id\": {{ $('Webhook').item.json.body.sale.order_id }},\n  \"order_item_id\": {{ $('Webhook').item.json.body.sale.order_item_id }},\n  \"reference_number\": \"{{ $('Webhook').item.json.body.sale.order_item_id }}(Order: {{ $('Webhook').item.json.body.sale.order_id }})\",\n  \"salesorder_number\": \"{{ $('Webhook').item.json.body.sale.order_item_id }}(Order: {{ $('Webhook').item.json.body.sale.order_id }})\",\n  \"is_inclusive_tax\": true,\n  \"due_date\": {{ $('Webhook').item.json.body.event_timestamp_utc.slice(0, 10) }},\n  \"location_id\": \"{{ $('Get row(s)').item.json.ParentLocationID }}\",\n  \"notes\": \"Customer name: {{ $('Webhook').item.json.body.sale.customer }}\",\n  \"line_items\": [{\n    \"item_id\": \"{{ $('Get Item ID from SKU').item.json.items[0].item_id }}\",\n    \"name\": \"{{ $('Webhook').item.json.body.sale.product_title }}\",\n    \"rate\": {{ (() => {\n  const price = $('Webhook').item.json.body.sale.selling_price;\n  const qty = $('Webhook').item.json.body.sale.quantity;\n  if (qty === 0) throw new Error('Quantity cannot be zero');\n  return price / qty;\n})() }},\n    \"quantity\": {{ $('Webhook').item.json.body.sale.quantity }},\n    \"tax_id\": \"{{ $('Get row(s)').item.json.TaxID }}\",\n    \"item_total\": {{ $('Webhook').item.json.body.sale.selling_price }},\n    \"location_id\": \"{{ $('Get row(s)').item.json.LocationID }}\"\n  }]\n }",
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2480,
            368
          ],
          "id": "d099e97d-a493-4ba0-bf3a-202815532fba",
          "name": "Build JSON",
          "notes": "Added date check to see if date is valid and safe division for \"rate\" in case quantity is zero"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Set Endpoint').item.json.zoho_endpoint }}/{{ $json.invoice_id }}/status/sent",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            6560,
            112
          ],
          "id": "f3b3b099-d358-4179-894f-27d95f6e8003",
          "name": "Mark Invoice as Sent"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Set Endpoint').item.json.zoho_endpoint }}/mapwithorder",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                },
                {
                  "name": "invoice_ids",
                  "value": "={{ $('Extract invoice_id').item.json.invoice_id }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            6768,
            112
          ],
          "id": "79ea6a67-3a85-4bc6-ba23-f675df713a7d",
          "name": "Map to Salesorder"
        },
        {
          "parameters": {
            "operation": "get",
            "dataTableId": {
              "__rl": true,
              "value": "P2idoCVDSQnCITNY",
              "mode": "list",
              "cachedResultName": "zoho_info",
              "cachedResultUrl": "/projects/A2rkQg960Oa5Tvrh/datatables/P2idoCVDSQnCITNY"
            },
            "filters": {
              "conditions": [
                {
                  "keyName": "SellerID",
                  "keyValue": "={{ $('Webhook').item.json.params.seller_id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.dataTable",
          "typeVersion": 1.1,
          "position": [
            -64,
            416
          ],
          "id": "b7faec4b-cd5a-44a4-9152-87aacdf90fea",
          "name": "Get row(s)"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.noOp",
          "typeVersion": 1,
          "position": [
            2016,
            560
          ],
          "id": "12f4f9ef-1f63-47f8-9219-4c1e55029ef9",
          "name": "No Operation, do nothing"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "8f3e18e0-c669-4dd3-a2e7-f8c04ba01d7a",
                  "leftValue": "={{ $('Set Endpoint').item.json.zoho_endpoint }}",
                  "rightValue": 3,
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            1792,
            464
          ],
          "id": "56528ec2-07b7-4f83-a907-c7f4b6083fb3",
          "name": "if valid transaction"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "=https://www.zohoapis.com/inventory/v1/packages",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                },
                {
                  "name": "salesorder_id",
                  "value": "={{ $json.body.salesorder.salesorder_id }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n  \"package_number\": \"{{ $json.body.salesorder.salesorder_number }}\",\n  \"date\": \"{{ $json.body.salesorder.date }}\",\n  \"line_items\": [\n    {\n      \"so_line_item_id\": \"{{ $json.body.salesorder.line_items[0].line_item_id }}\",\n      \"quantity\": {{ $json.body.salesorder.line_items[0].quantity }}\n    }\n  ],\n  \"notes\": \"{{ $json.body.salesorder.notes }}\"\n} ",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            4928,
            -672
          ],
          "id": "41afaa63-5132-4ae6-afa9-83a1dd3f9472",
          "name": "Create package",
          "retryOnFail": true,
          "maxTries": 2,
          "waitBetweenTries": 2000,
          "onError": "continueErrorOutput"
        },
        {
          "parameters": {
            "url": "=https://www.zohoapis.com/inventory/v1/packages",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "=organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                },
                {
                  "name": "search_text",
                  "value": "={{ $('Build JSON').item.json.doc_number }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            2928,
            368
          ],
          "id": "0ae581b6-d038-41f2-a6e7-a8c41bac503e",
          "name": "Get Package"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "=https://www.zohoapis.com/inventory/v1/shipmentorders",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                },
                {
                  "name": "salesorder_id",
                  "value": "={{ $json.packages[0].salesorder_id }}"
                },
                {
                  "name": "package_ids",
                  "value": "={{ $json.packages[0].package_id }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n  \"shipment_number\": \"{{ $('Build JSON').item.json.reference_number }}\",\n  \"date\": \"{{ $('Build JSON').item.json.date }}\",\n  \"delivery_method\": \"Takealot\",\n  \"tracking_number\": \"{{ $('Build JSON').item.json.reference_number }}\"\n} ",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            5200,
            240
          ],
          "id": "84e2f9c6-91b2-4ca6-b1aa-1ab285b2b1ae",
          "name": "Create Shipment",
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "=https://www.zohoapis.com/inventory/v1/shipmentorders/{{ $json.shipmentorder.shipment_id }}/status/delivered",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            5600,
            256
          ],
          "id": "d4917ca1-51c5-4630-958c-c954508d2eb1",
          "name": "Mark as Delivered"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "=https://www.zohoapis.com/inventory/v1/salesreturns",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                },
                {
                  "name": "salesorder_id",
                  "value": "={{ $('Get SO Details').item.json.salesorder.salesorder_id }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n    \"date\": \"{{ $('Build JSON').item.json.date }}\",\n    \"return_type\": \"return_credit\",\n    \"location_id\": \"{{ $('Get SO Details').item.json.salesorder.location_id }}\",\n    \"line_items\": [\n        {\n            \"item_id\": \"{{ $('Get SO Details').item.json.salesorder.line_items[0].item_id }}\",\n            \"salesorder_item_id\": \"{{ $('Get SO Details').item.json.salesorder.line_items[0].line_item_id }}\",\n            \"quantity\": {{ $('Build JSON').item.json.line_items[0].quantity }},\n            \"location_id\": \"{{ $('Build JSON').item.json.line_items[0].location_id }}\"\n        }\n    ]\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            4048,
            1776
          ],
          "id": "fe4f06f8-f8cc-4800-b122-85ec14082b3c",
          "name": "Create Sales Return"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "=https://www.zohoapis.com/inventory/v1/salesreturnreceives",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                },
                {
                  "name": "salesreturn_id",
                  "value": "={{ $json.salesreturn.salesreturn_id }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n    \"date\": \"{{ $json.salesreturn.date }}\",\n    \"line_items\": [\n        {\n            \"line_item_id\": \"{{ $json.salesreturn.line_items[0].line_item_id }}\",\n            \"quantity\": {{ $json.salesreturn.line_items[0].quantity }}\n        }\n    ]\n} ",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            4272,
            1776
          ],
          "id": "66680dc4-1e04-44bc-8510-730943cf0196",
          "name": "Receive Sales Return",
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 3
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('Webhook').item.json.body.sale.sale_status_id }}",
                        "rightValue": 2,
                        "operator": {
                          "type": "number",
                          "operation": "equals"
                        },
                        "id": "2bfe015f-886e-410e-a6fa-5f3c5c78f27e"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Preparing"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 3
                    },
                    "conditions": [
                      {
                        "id": "9a4a839e-94a9-47e8-aeb3-7f54e02d9b9a",
                        "leftValue": "={{ $('Webhook').item.json.body.sale.sale_status_id }}",
                        "rightValue": 3,
                        "operator": {
                          "type": "number",
                          "operation": "equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Shipped"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 3
                    },
                    "conditions": [
                      {
                        "id": "c1b2e3aa-9b22-449e-9027-0483a4d7ba3f",
                        "leftValue": "={{ $('Webhook').item.json.body.sale.sale_status_id }}",
                        "rightValue": 19,
                        "operator": {
                          "type": "number",
                          "operation": "equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Returned"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.4,
          "position": [
            2704,
            352
          ],
          "id": "67bd83cd-1721-4f03-9645-fc5dd5255d70",
          "name": "Switch1"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Set Endpoint').item.json.zoho_endpoint }}",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={{ $('Build JSON').item.json.toJsonString() }}",
            "options": {
              "response": {
                "response": {
                  "fullResponse": true,
                  "neverError": true,
                  "responseFormat": "json"
                }
              }
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            3488,
            -256
          ],
          "id": "4865e69f-9e68-4106-9d45-bef3ffc12efd",
          "name": "Create Salesorder",
          "retryOnFail": true,
          "maxTries": 2,
          "waitBetweenTries": 2000,
          "onError": "continueErrorOutput"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Set Endpoint').item.json.zoho_endpoint }}",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={{ $('Build JSON').item.json.toJsonString() }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            6176,
            208
          ],
          "id": "909bcb86-660e-4120-9cf7-6770ef2159bb",
          "name": "Create Invoice"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Set Endpoint').item.json.zoho_endpoint }}",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={{ $('Build JSON').item.json.toJsonString() }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            4496,
            1776
          ],
          "id": "f3e281dc-3e61-4e91-8564-fed313c409d8",
          "name": "Create Credit Note"
        },
        {
          "parameters": {
            "url": "=https://www.zohoapis.com/inventory/v1/salesorders",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                },
                {
                  "name": "search_text",
                  "value": "={{ $json.reference_number }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            2864,
            1584
          ],
          "id": "0d226bf8-19fa-4be5-9ad9-04fef58a6f98",
          "name": "Get Original Sales Order Number",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "url": "=https://www.zohoapis.com/inventory/v1/salesorders/{{ $json.salesorders[0].salesorder_id }}",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            3376,
            1488
          ],
          "id": "8a9a8728-c201-4016-8ff9-0a1f720692fb",
          "name": "Get SO Details"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "d3418105-3246-4d2f-a5b4-a0c693f137d3",
                  "leftValue": "={{ $json.salesorders }}",
                  "rightValue": "",
                  "operator": {
                    "type": "array",
                    "operation": "exists",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            3152,
            1584
          ],
          "id": "468a7244-2a8d-45e0-8411-a2104cb4e7c0",
          "name": "Found Original Sales Order"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.noOp",
          "typeVersion": 1,
          "position": [
            3376,
            1680
          ],
          "id": "2f140d0c-4e54-42d5-bfc3-6a2cbfc33159",
          "name": "No Operation, do nothing1"
        },
        {
          "parameters": {
            "url": "=https://www.zohoapis.com/inventory/v1/salesreturns",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                },
                {
                  "name": "search_text",
                  "value": "={{ $json.salesorder.salesorder_number }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n    \"date\": \"{{ $('Build JSON').item.json.date }}\",\n    \"location_id\": \"{{ $json.salesorder.location_id }}\",\n    \"line_items\": [\n        {\n            \"item_id\": \"{{ $json.salesorder.line_items[0].item_id }}\",\n            \"salesorder_item_id\": \"{{ $json.salesorder.line_items[0].line_item_id }}\",\n            \"quantity\": {{ $('Build JSON').item.json.line_items[0].quantity }},\n            \"location_id\": \"{{ $('Build JSON').item.json.line_items[0].location_id }}\"\n        }\n    ]\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            3600,
            1488
          ],
          "id": "a7c86499-84b5-48f0-adfc-3ecdce8f409f",
          "name": "Check for Existing SR"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "d442d061-0c45-4f91-8197-37b8d34e2cf4",
                  "leftValue": "={{ $json.salesreturns.length }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "number",
                    "operation": "gt"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            3824,
            1488
          ],
          "id": "af670c31-9da6-40f4-808b-eb82c44f4559",
          "name": "SR Exists"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "d442d061-0c45-4f91-8197-37b8d34e2cf4",
                  "leftValue": "={{ $json.salesreturns[0].quantity_yet_to_receive }}",
                  "rightValue": -1,
                  "operator": {
                    "type": "number",
                    "operation": "gt"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            4048,
            1488
          ],
          "id": "bc8780ca-7b8c-48ea-8f55-7e1849d5b5d9",
          "name": "Available for return"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.noOp",
          "typeVersion": 1,
          "position": [
            4272,
            1584
          ],
          "id": "a28f0175-9702-4305-9f7e-6660f4906cfc",
          "name": "No Operation, do nothing2"
        },
        {
          "parameters": {
            "method": "PUT",
            "url": "=https://www.zohoapis.com/inventory/v1/salesreturns/{{ $json.salesreturns[0].salesreturn_id }}",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n    \"date\": \"{{ $('Build JSON').item.json.date }}\",\n    \"location_id\": \"{{ $json.salesorder.location_id }}\",\n    \"line_items\": [\n        {\n            \"item_id\": \"{{ $json.salesorder.line_items[0].item_id }}\",\n            \"salesorder_item_id\": \"{{ $json.salesorder.line_items[0].line_item_id }}\",\n            \"quantity\": {{ $('Build JSON').item.json.line_items[0].quantity }},\n            \"location_id\": \"{{ $('Build JSON').item.json.line_items[0].location_id }}\"\n        }\n    ]\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            4272,
            1424
          ],
          "id": "4029a5c9-4946-4254-9616-044f2dac24d3",
          "name": "Update SR"
        },
        {
          "parameters": {
            "content": "## Click [here](https://n8n.tallypro.co.za/form/commit?id=XYhKungDNJV46vQF) to commit change ",
            "height": 140,
            "width": 1224,
            "color": 5
          },
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -528,
            240
          ],
          "typeVersion": 1,
          "id": "9f61b6de-7d67-4253-bd47-37b685aa75f7",
          "name": "Sticky Note"
        },
        {
          "parameters": {
            "url": "={{ $('Set Endpoint').item.json.zoho_endpoint }}",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                },
                {
                  "name": "salesorder_number",
                  "value": "={{ $('Build JSON').item.json.reference_number }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={{ $('Build JSON').item.json.toJsonString() }}",
            "options": {
              "response": {
                "response": {
                  "fullResponse": true,
                  "neverError": true,
                  "responseFormat": "json"
                }
              }
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            3024,
            -336
          ],
          "id": "38f3fef2-5bff-49cc-a0ca-5b022977c81c",
          "name": "Check for Existing SO"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "e5eb83b5-8333-475a-8184-ddc2d334528d",
                  "leftValue": "={{ $json.body.salesorders.length }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "number",
                    "operation": "gt"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            3232,
            -336
          ],
          "id": "ab7bba60-a5f9-4c01-a8d8-dc1da002fa75",
          "name": "SO Exists?"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "43a58f31-369b-4b21-8ed0-620bb3f52cac",
                  "leftValue": "={{ $json.statusCode }}",
                  "rightValue": 200,
                  "operator": {
                    "type": "number",
                    "operation": "gte"
                  }
                },
                {
                  "id": "eca26688-5dd0-425f-8936-08a78e1c7e56",
                  "leftValue": "={{ $json.statusCode }}",
                  "rightValue": 299,
                  "operator": {
                    "type": "number",
                    "operation": "lte"
                  }
                },
                {
                  "id": "335c6485-e0ad-4a9b-9de6-94b570f4c89c",
                  "leftValue": "={{ $json.body.salesorder.salesorder_id }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "exists",
                    "singleValue": true
                  }
                },
                {
                  "id": "df8a4a14-54b8-48a3-bf80-a5610815f6e2",
                  "leftValue": "={{ $json.body.salesorder.line_items.length }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "number",
                    "operation": "gt"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            3760,
            -320
          ],
          "id": "65e6be3a-d72a-4ba1-9c77-918f343324d7",
          "name": "Validate SO Creation"
        },
        {
          "parameters": {
            "jsCode": "const response = $input.item.json.body.salesorder;\nconst expected = $('Build JSON').item.json;\n\n// Validate critical fields match\nconst errors = [];\n\nif (response.order_id !== expected.salesorder_id) {\n  errors.push(`Order ID mismatch: ${response.salesorder_id} vs ${expected.salesorder_id}`);\n}\n\nif (Math.abs(response.total - expected.line_items[0].item_total) > 0.01) {\n  errors.push(`Total mismatch: ${response.total} vs ${expected.line_items[0].item_total}`);\n}\n\nif (response.line_items[0].quantity !== expected.line_items[0].quantity) {\n  errors.push(`Quantity mismatch`);\n}\n\nif (errors.length > 0) {\n  throw new Error(`SO validation failed: ${errors.join(', ')}`);\n}\n\nreturn {\n  json: {\n    validated: true,\n    salesorder_id: response.salesorder_id,\n    ...response\n  }\n};"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            3984,
            -416
          ],
          "id": "f497d484-afaf-4aad-8cb1-651927f94374",
          "name": "Validate SO Data"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "d5bdf613-bb65-41cf-8d17-3ca871358eaa",
                  "leftValue": "={{ $json.body.salesorder.line_items[0].quantity_packed }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "number",
                    "operation": "equals"
                  }
                },
                {
                  "id": "0f2d749c-be5a-43a7-81aa-aa7a7f900d44",
                  "leftValue": "={{ $json.body.salesorder.status }}",
                  "rightValue": "confirmed",
                  "operator": {
                    "type": "string",
                    "operation": "equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            4672,
            -592
          ],
          "id": "e44637fc-27a5-4155-9201-4e8208598740",
          "name": "Check Package Prerequisites"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 3
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.body.salesorders[0].order_status }}",
                        "rightValue": "void",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "2bfe015f-886e-410e-a6fa-5f3c5c78f27e"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "void"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 3
                    },
                    "conditions": [
                      {
                        "id": "9a4a839e-94a9-47e8-aeb3-7f54e02d9b9a",
                        "leftValue": "={{ $json.body.salesorders[0].order_status }}",
                        "rightValue": "confirmed",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "confirmed"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 3
                    },
                    "conditions": [
                      {
                        "id": "c1b2e3aa-9b22-449e-9027-0483a4d7ba3f",
                        "leftValue": "={{ $json.body.salesorders[0].order_status }}",
                        "rightValue": "draft",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "draft"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.4,
          "position": [
            3488,
            -496
          ],
          "id": "2f146bbb-9bee-4f71-83c2-ffa2be2f9232",
          "name": "Switch"
        },
        {
          "parameters": {
            "url": "={{ $('Set Endpoint').item.json.zoho_endpoint }}/{{ $('Validate SO Data').item.json.salesorder_id }}",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={{ $('Build JSON').item.json.toJsonString() }}",
            "options": {
              "response": {
                "response": {
                  "fullResponse": true,
                  "neverError": true,
                  "responseFormat": "json"
                }
              }
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            4464,
            -528
          ],
          "id": "16ac7f23-b671-4e06-9b2d-1b4639106c83",
          "name": "Get Created SO"
        },
        {
          "parameters": {
            "url": "={{ $('Set Endpoint').item.json.zoho_endpoint }}/{{ $('Check for Existing SO').item.json.body.salesorders[0].salesorder_id }}",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "options": {
              "response": {
                "response": {
                  "fullResponse": true,
                  "neverError": true,
                  "responseFormat": "json"
                }
              }
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            4464,
            -720
          ],
          "id": "3c43a92e-b3e2-4ff3-96ee-c27d84fb12b7",
          "name": "Get Existing SO"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                  "name": "timestamp",
                  "value": "={{ new Date().toISOString() }}",
                  "type": "string"
                },
                {
                  "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                  "name": "execution_id",
                  "value": "={{ $execution.id }}",
                  "type": "string"
                },
                {
                  "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                  "name": "workflow_name",
                  "value": "Takealot Status Change Webhook",
                  "type": "string"
                },
                {
                  "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                  "name": "seller_id",
                  "value": "={{ $('Webhook').item.json.params.seller_id }}",
                  "type": "string"
                },
                {
                  "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                  "name": "order_item_id",
                  "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                  "type": "string"
                },
                {
                  "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                  "name": "stage",
                  "value": "create_so",
                  "type": "string"
                },
                {
                  "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                  "name": "status",
                  "value": "error",
                  "type": "string"
                },
                {
                  "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                  "name": "message",
                  "value": "Sales Order creation failed",
                  "type": "string"
                },
                {
                  "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                  "name": "details",
                  "value": "={{ $('Webhook').item.json.toJsonString() }}",
                  "type": "object"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            3952,
            -128
          ],
          "id": "1e614a3c-48e5-48f6-8e7b-fb9ed139da97",
          "name": "Log Entry - Failed SO Create"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                  "name": "timestamp",
                  "value": "={{ new Date().toISOString() }}",
                  "type": "string"
                },
                {
                  "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                  "name": "execution_id",
                  "value": "={{ $execution.id }}",
                  "type": "string"
                },
                {
                  "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                  "name": "workflow_name",
                  "value": "Takealot Status Change Webhook",
                  "type": "string"
                },
                {
                  "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                  "name": "seller_id",
                  "value": "={{ $('Webhook').item.json.params.seller_id }}",
                  "type": "string"
                },
                {
                  "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                  "name": "order_item_id",
                  "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                  "type": "string"
                },
                {
                  "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                  "name": "stage",
                  "value": "confirm_so",
                  "type": "string"
                },
                {
                  "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                  "name": "status",
                  "value": "error",
                  "type": "string"
                },
                {
                  "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                  "name": "message",
                  "value": "Sales Order confirmation failed",
                  "type": "string"
                },
                {
                  "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                  "name": "details",
                  "value": "={{ $('Webhook').item.json.toJsonString() }}",
                  "type": "object"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            4496,
            -336
          ],
          "id": "733c646d-82f1-4444-8fb3-89c974ddd0aa",
          "name": "Log Entry - SO Confirm Fail"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                  "name": "timestamp",
                  "value": "={{ new Date().toISOString() }}",
                  "type": "string"
                },
                {
                  "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                  "name": "execution_id",
                  "value": "={{ $execution.id }}",
                  "type": "string"
                },
                {
                  "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                  "name": "workflow_name",
                  "value": "Takealot Status Change Webhook",
                  "type": "string"
                },
                {
                  "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                  "name": "seller_id",
                  "value": "={{ $('Webhook').item.json.params.seller_id }}",
                  "type": "string"
                },
                {
                  "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                  "name": "order_item_id",
                  "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                  "type": "string"
                },
                {
                  "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                  "name": "stage",
                  "value": "package_check",
                  "type": "string"
                },
                {
                  "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                  "name": "status",
                  "value": "error",
                  "type": "string"
                },
                {
                  "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                  "name": "message",
                  "value": "Package Prerequisites Failed",
                  "type": "string"
                },
                {
                  "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                  "name": "details",
                  "value": "={{ $('Webhook').item.json.toJsonString() }}",
                  "type": "object"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            4928,
            -464
          ],
          "id": "104e58b1-0392-4fb9-b4e3-d9fbf69f2b15",
          "name": "Log Entry - Package Prerequisites failed"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                  "name": "timestamp",
                  "value": "={{ new Date().toISOString() }}",
                  "type": "string"
                },
                {
                  "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                  "name": "execution_id",
                  "value": "={{ $execution.id }}",
                  "type": "string"
                },
                {
                  "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                  "name": "workflow_name",
                  "value": "Takealot Status Change Webhook",
                  "type": "string"
                },
                {
                  "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                  "name": "seller_id",
                  "value": "={{ $('Webhook').item.json.params.seller_id }}",
                  "type": "string"
                },
                {
                  "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                  "name": "order_item_id",
                  "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                  "type": "string"
                },
                {
                  "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                  "name": "stage",
                  "value": "validate_so",
                  "type": "string"
                },
                {
                  "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                  "name": "status",
                  "value": "error",
                  "type": "string"
                },
                {
                  "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                  "name": "message",
                  "value": "Sales Order invalid",
                  "type": "string"
                },
                {
                  "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                  "name": "details",
                  "value": "={{ $('Webhook').item.json.toJsonString() }}",
                  "type": "object"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            4160,
            -240
          ],
          "id": "0e21a2ab-1f0d-49e6-a936-1c9e0bcffeac",
          "name": "Log Entry - Invalid SO"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                  "name": "timestamp",
                  "value": "={{ new Date().toISOString() }}",
                  "type": "string"
                },
                {
                  "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                  "name": "execution_id",
                  "value": "={{ $execution.id }}",
                  "type": "string"
                },
                {
                  "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                  "name": "workflow_name",
                  "value": "Takealot Status Change Webhook",
                  "type": "string"
                },
                {
                  "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                  "name": "seller_id",
                  "value": "={{ $('Webhook').item.json.params.seller_id }}",
                  "type": "string"
                },
                {
                  "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                  "name": "order_item_id",
                  "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                  "type": "string"
                },
                {
                  "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                  "name": "stage",
                  "value": "void_so",
                  "type": "string"
                },
                {
                  "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                  "name": "status",
                  "value": "error",
                  "type": "string"
                },
                {
                  "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                  "name": "message",
                  "value": "Sales Order exists in status VOID",
                  "type": "string"
                },
                {
                  "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                  "name": "details",
                  "value": "={{ $('Webhook').item.json.toJsonString() }}",
                  "type": "object"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            3680,
            -688
          ],
          "id": "9c9d6f02-6e27-4fdb-ad75-c998b96beac4",
          "name": "Log Entry - SO = Void"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                  "name": "timestamp",
                  "value": "={{ new Date().toISOString() }}",
                  "type": "string"
                },
                {
                  "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                  "name": "execution_id",
                  "value": "={{ $execution.id }}",
                  "type": "string"
                },
                {
                  "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                  "name": "workflow_name",
                  "value": "Takealot Status Change Webhook",
                  "type": "string"
                },
                {
                  "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                  "name": "seller_id",
                  "value": "={{ $('Webhook').item.json.params.seller_id }}",
                  "type": "string"
                },
                {
                  "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                  "name": "order_item_id",
                  "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                  "type": "string"
                },
                {
                  "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                  "name": "stage",
                  "value": "package_create",
                  "type": "string"
                },
                {
                  "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                  "name": "status",
                  "value": "error",
                  "type": "string"
                },
                {
                  "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                  "name": "message",
                  "value": "Package Create Failed",
                  "type": "string"
                },
                {
                  "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                  "name": "details",
                  "value": "={{ $('Webhook').item.json.toJsonString() }}",
                  "type": "object"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            5136,
            -624
          ],
          "id": "9afc2845-9d12-41f0-92e5-f009ed90bdcd",
          "name": "Log Entry - Create Package failed"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                  "name": "timestamp",
                  "value": "={{ new Date().toISOString() }}",
                  "type": "string"
                },
                {
                  "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                  "name": "execution_id",
                  "value": "={{ $execution.id }}",
                  "type": "string"
                },
                {
                  "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                  "name": "workflow_name",
                  "value": "Takealot Status Change Webhook",
                  "type": "string"
                },
                {
                  "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                  "name": "seller_id",
                  "value": "={{ $('Webhook').item.json.params.seller_id }}",
                  "type": "string"
                },
                {
                  "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                  "name": "order_item_id",
                  "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                  "type": "string"
                },
                {
                  "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                  "name": "stage",
                  "value": "so_workflow",
                  "type": "string"
                },
                {
                  "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                  "name": "status",
                  "value": "success",
                  "type": "string"
                },
                {
                  "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                  "name": "message",
                  "value": "Salesorder workflow completed successfully",
                  "type": "string"
                },
                {
                  "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                  "name": "details",
                  "value": "={{ $('Webhook').item.json.toJsonString() }}",
                  "type": "object"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            5152,
            -816
          ],
          "id": "4616373a-f409-4da9-a2a3-7ff658ca3b93",
          "name": "Log Entry - Success"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://urbanetrains.backendless.app/api/data/n8n-status-change-webhook-workflow-logs",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={{ $json }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            5584,
            -272
          ],
          "id": "008e76ba-56f5-4546-8302-500be80a254d",
          "name": "Log Result to Backendless"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://urbanetrains.backendless.app/api/data/n8n-status-change-webhook-workflow-logs",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={{ $json }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            3856,
            -688
          ],
          "id": "2e2c2aff-7590-4113-b5cb-e4792d68cfc7",
          "name": "Log Event to Backendless"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "76b9b3c3-dc42-4b56-bbf0-0597eb51f0db",
                  "leftValue": "={{ $json.packages }}",
                  "rightValue": "",
                  "operator": {
                    "type": "array",
                    "operation": "exists",
                    "singleValue": true
                  }
                },
                {
                  "id": "0471f1e8-acdf-4e45-8444-7864bff5acf5",
                  "leftValue": "={{ $json.packages.length }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "number",
                    "operation": "gt"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            3136,
            368
          ],
          "id": "02e0b3d9-b0e0-40b8-a03f-fb4d12fb2066",
          "name": "Does Package Exist?"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "6e609447-105e-4d44-bb7c-c5e5d3f0a814",
                  "leftValue": "={{ $json.packages[0].shipment_id }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            4944,
            160
          ],
          "id": "9556bb66-3043-4610-9c2e-e2ef5eeba0b3",
          "name": "Shipment Exists?"
        },
        {
          "parameters": {
            "url": "=https://www.zohoapis.com/inventory/v1/shipmentorders/{{ $json.packages[0].shipment_id }}",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            5200,
            64
          ],
          "id": "8dd1c10f-d1d6-4db0-9a4e-049993140cfa",
          "name": "Get Shipment",
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "ea4e921e-d36f-4924-b2a0-c3cda01edc1f",
                  "leftValue": "={{ $json.shipmentorder.shipment_status }}",
                  "rightValue": "delivered",
                  "operator": {
                    "type": "string",
                    "operation": "equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            5392,
            160
          ],
          "id": "496286c7-3a20-46b7-bc0d-af89ca748e0e",
          "name": "Is Shipment Delivered?"
        },
        {
          "parameters": {
            "url": "=https://www.zohoapis.com/inventory/v1/invoices",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                },
                {
                  "name": "reference_number",
                  "value": "={{ $('Build JSON').item.json.reference_number }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            5760,
            112
          ],
          "id": "a7140acf-f907-4460-a8d6-3ee011e10c0a",
          "name": "Get Invoices",
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "f4b81d75-0bc3-4522-a63f-a59ab360ab14",
                  "leftValue": "={{ $json.invoices }}",
                  "rightValue": "",
                  "operator": {
                    "type": "array",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            5952,
            112
          ],
          "id": "4e28249e-11fb-42d6-8399-f0e15b1f213b",
          "name": "Invoice Exists?"
        },
        {
          "parameters": {
            "url": "=https://www.zohoapis.com/inventory/v1/invoices/{{ $json.invoices[0].invoice_id }}",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                },
                {
                  "name": "reference_number",
                  "value": "={{ $('Build JSON').item.json.reference_number }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            6176,
            32
          ],
          "id": "6813f473-3c57-45b4-bf2f-8790151ee0c1",
          "name": "Get Invoice",
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "5ae8b968-ab68-43a5-aa4b-0bbfa593b95a",
                  "name": "invoice_id",
                  "value": "={{ $json.invoice.invoice_id }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            6352,
            112
          ],
          "id": "2af26e17-2f69-4f78-8328-965fbce2daae",
          "name": "Extract invoice_id"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "=https://n8n.tallypro.co.za/webhook/fa329524-5a4e-4fab-a636-cfcd3b496f4b/{{ $('Webhook').item.json.params.seller_id }}",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                },
                {
                  "name": "x-takealot-event",
                  "value": "sale_status_changed"
                },
                {
                  "name": "x-n8n-self-heal",
                  "value": "true"
                },
                {
                  "name": "x-n8n-retry-count",
                  "value": "={{ ($('Webhook').item.json.headers['x-n8n-retry-count'] ? parseInt($('Webhook').item.json.headers['x-n8n-retry-count']) : 0) + 1 }}"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={{ JSON.stringify({\n  sale: {\n    order_item_id: $('Webhook').item.json.body.sale.order_item_id,\n    offer_id: $('Webhook').item.json.body.sale.offer_id,\n    order_id: $('Webhook').item.json.body.sale.order_id,\n    warehouse: $('Webhook').item.json.body.sale.warehouse,\n    warehouse_id: $('Webhook').item.json.body.sale.warehouse_id,\n    sale_status_id: 2,\n    sale_status: 'Preparing for Customer',\n    order_date: $('Webhook').item.json.body.sale.order_date,\n    product_title: $('Webhook').item.json.body.sale.product_title,\n    takealot_url_mobi: $('Webhook').item.json.body.sale.takealot_url_mobi,\n    sku: $('Webhook').item.json.body.sale.sku,\n    tsin: $('Webhook').item.json.body.sale.tsin,\n    quantity: $('Webhook').item.json.body.sale.quantity,\n    selling_price: $('Webhook').item.json.body.sale.selling_price,\n    customer: $('Webhook').item.json.body.sale.customer,\n    customer_warehouse: $('Webhook').item.json.body.sale.customer_warehouse\n  },\n  event_timestamp_utc: $('Webhook').item.json.body.event_timestamp_utc\n}) }}",
            "options": {
              "response": {
                "response": {
                  "fullResponse": true,
                  "neverError": true
                }
              },
              "timeout": 30000
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            3488,
            672
          ],
          "id": "a618e5c0-d9a9-4d6a-b923-9af3d08a4506",
          "name": "Recursive call"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            3888,
            608
          ],
          "id": "95440ee9-3f8a-44c8-adaf-7454f735350d",
          "name": "Wait 5 sec",
          "webhookId": "5930ab40-b44d-49ac-a930-83ec5e5eac09"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                  "name": "timestamp",
                  "value": "={{ new Date().toISOString() }}",
                  "type": "string"
                },
                {
                  "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                  "name": "execution_id",
                  "value": "={{ $execution.id }}",
                  "type": "string"
                },
                {
                  "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                  "name": "workflow_name",
                  "value": "Takealot Status Change Webhook",
                  "type": "string"
                },
                {
                  "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                  "name": "seller_id",
                  "value": "={{ $('Webhook').item.json.params.seller_id }}",
                  "type": "string"
                },
                {
                  "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                  "name": "order_item_id",
                  "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                  "type": "string"
                },
                {
                  "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                  "name": "stage",
                  "value": "No Package",
                  "type": "string"
                },
                {
                  "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                  "name": "status",
                  "value": "self-heal",
                  "type": "string"
                },
                {
                  "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                  "name": "message",
                  "value": "Attempting self-heal",
                  "type": "string"
                },
                {
                  "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                  "name": "details",
                  "value": "={{ $('Webhook').item.json.toJsonString() }}",
                  "type": "object"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            3104,
            624
          ],
          "id": "26f443f3-ca56-40cb-9204-8da336c6bf7f",
          "name": "Log Entry - Self-Heal start"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://urbanetrains.backendless.app/api/data/n8n-status-change-webhook-workflow-logs",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={{ $json }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            3264,
            624
          ],
          "id": "1878cd5e-e271-44b3-a1e4-e9587fb5f56f",
          "name": "Log status to Backendless"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                  "name": "timestamp",
                  "value": "={{ new Date().toISOString() }}",
                  "type": "string"
                },
                {
                  "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                  "name": "execution_id",
                  "value": "={{ $execution.id }}",
                  "type": "string"
                },
                {
                  "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                  "name": "workflow_name",
                  "value": "Takealot Status Change Webhook",
                  "type": "string"
                },
                {
                  "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                  "name": "seller_id",
                  "value": "={{ $('Webhook').item.json.params.seller_id }}",
                  "type": "string"
                },
                {
                  "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                  "name": "order_item_id",
                  "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                  "type": "string"
                },
                {
                  "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                  "name": "stage",
                  "value": "create_so",
                  "type": "string"
                },
                {
                  "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                  "name": "status",
                  "value": "error",
                  "type": "string"
                },
                {
                  "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                  "name": "message",
                  "value": "Self-heal failed",
                  "type": "string"
                },
                {
                  "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                  "name": "details",
                  "value": "={{ $('Webhook').item.json.toJsonString() }}",
                  "type": "object"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            3632,
            416
          ],
          "id": "eb854239-1f5b-4615-9180-79642a916da7",
          "name": "Log Entry - Failed Recursion"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://urbanetrains.backendless.app/api/data/n8n-status-change-webhook-workflow-logs",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={{ $json }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            3808,
            416
          ],
          "id": "30150c74-ca61-42ca-a57d-088a1201dae3",
          "name": "Log Recursion fail to Backendless"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "e4d97c1f-6562-4117-945b-a6ff0b4e2131",
                  "leftValue": "={{ parseInt($('Webhook').item.json.headers['x-n8n-retry-count'] || '0') }}",
                  "rightValue": 2,
                  "operator": {
                    "type": "number",
                    "operation": "gt"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            3408,
            448
          ],
          "id": "03aac066-e2d6-446f-bd68-dd074e9b9afa",
          "name": "Prevent infinite loop"
        },
        {
          "parameters": {
            "url": "=https://www.zohoapis.com/inventory/v1/packages",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "=organization_id",
                  "value": "={{ $('Get row(s)').item.json.OrganizationID }}"
                },
                {
                  "name": "search_text",
                  "value": "={{ $('Build JSON').item.json.doc_number }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Zoho-oauthtoken {{ $('Get Zoho Access Token').item.json.access_token }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            4096,
            576
          ],
          "id": "3ac6a3e6-2a6c-40a1-9cff-421af5bdd1da",
          "name": "Get Package1"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://urbanetrains.backendless.app/api/data/n8n-status-change-webhook-workflow-logs",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={{ $json }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            4752,
            448
          ],
          "id": "320b4b3c-3f50-4c24-ad12-41e457da22e9",
          "name": "Log result"
        },
        {
          "parameters": {
            "url": "=https://httpbin.dev/base64/encode/{{ encodeURIComponent($json.HMAC) }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            1056,
            464
          ],
          "id": "d6f1dc40-bbde-4160-b00f-f45ae88ee304",
          "name": "HTTP Request"
        },
        {
          "parameters": {
            "action": "hmac",
            "binaryData": true,
            "binaryPropertyName": "={{ $('Merge').item.binary.data }}",
            "type": "SHA256",
            "dataPropertyName": "HMAC",
            "secret": "={{ $json.takealot_webhook_secret }}"
          },
          "type": "n8n-nodes-base.crypto",
          "typeVersion": 1,
          "position": [
            768,
            464
          ],
          "id": "e2234e8e-9921-49bd-9c16-b12e02edb77b",
          "name": "Crypto"
        },
        {
          "parameters": {
            "mode": "combine",
            "combineBy": "combineByPosition",
            "options": {}
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            496,
            592
          ],
          "id": "e0e55edd-6656-4cd1-b86f-e3b0b359929d",
          "name": "Merge"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "22b3ebc9-54ae-4669-9b5b-5694dba9bf0a",
                  "leftValue": "={{ $json.data }}",
                  "rightValue": "={{ $('Webhook').item.json.headers['x-takealot-signature'] }}",
                  "operator": {
                    "type": "string",
                    "operation": "equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            1264,
            464
          ],
          "id": "9d89f32f-7932-41c1-a364-6a00b1785e60",
          "name": "Check HMAC"
        },
        {
          "parameters": {
            "operation": "toText",
            "sourceProperty": "=data",
            "options": {}
          },
          "type": "n8n-nodes-base.convertToFile",
          "typeVersion": 1.1,
          "position": [
            160,
            576
          ],
          "id": "36f5be25-010b-462c-b264-bf18e4f34ffe",
          "name": "Convert to File"
        },
        {
          "parameters": {
            "mode": "raw",
            "jsonOutput": "={{ { \"data\": \"https://n8n.tallypro.co.za/webhook/fa329524-5a4e-4fab-a636-cfcd3b496f4b/\" + $('Webhook').item.json.params.seller_id + JSON.stringify($('Webhook').item.json.body).split('\":').join('\": ').split(',\"').join(', \"').split(':{').join(': {').split('},').join('},') } }}",
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -64,
            576
          ],
          "id": "5ad7d4e9-c725-4271-9cf0-202596bbe3db",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "operation": "fromJson",
            "options": {}
          },
          "type": "n8n-nodes-base.extractFromFile",
          "typeVersion": 1.1,
          "position": [
            -288,
            576
          ],
          "id": "953db65f-857b-43a2-a16c-4f434c1fad55",
          "name": "Extract from File",
          "disabled": true
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                  "name": "timestamp",
                  "value": "={{ new Date().toISOString() }}",
                  "type": "string"
                },
                {
                  "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                  "name": "execution_id",
                  "value": "={{ $execution.id }}",
                  "type": "string"
                },
                {
                  "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                  "name": "workflow_name",
                  "value": "Takealot Status Change Webhook",
                  "type": "string"
                },
                {
                  "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                  "name": "seller_id",
                  "value": "={{ $('Webhook').item.json.params.seller_id }}",
                  "type": "string"
                },
                {
                  "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                  "name": "order_item_id",
                  "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                  "type": "string"
                },
                {
                  "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                  "name": "stage",
                  "value": "hmac_verify",
                  "type": "string"
                },
                {
                  "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                  "name": "status",
                  "value": "error",
                  "type": "string"
                },
                {
                  "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                  "name": "message",
                  "value": "HMAC signature does not match",
                  "type": "string"
                },
                {
                  "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                  "name": "details",
                  "value": "={{ $('Webhook').item.json.toJsonString() }}",
                  "type": "object"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1248,
            736
          ],
          "id": "23aa6ae0-9c3a-4f31-adfc-c81cce5e19c4",
          "name": "Log Entry - SO = Void1"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://urbanetrains.backendless.app/api/data/n8n-status-change-webhook-workflow-logs",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={{ $json }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            1424,
            736
          ],
          "id": "abc760fd-2422-4556-b04e-5dfc219643cf",
          "name": "Log HMAC failure"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "30bbedd7-b6cd-4b64-b74f-fccebfd37345",
                  "leftValue": "={{ $json.statusCode }}",
                  "rightValue": 200,
                  "operator": {
                    "type": "number",
                    "operation": "gte"
                  }
                },
                {
                  "id": "4682e40e-606c-4aeb-812f-ae0cf3b4ca4f",
                  "leftValue": "={{ $json.statusCode }}",
                  "rightValue": 299,
                  "operator": {
                    "type": "number",
                    "operation": "gte"
                  }
                }
              ],
              "combinator": "or"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            3664,
            672
          ],
          "id": "09409971-2188-4b37-858a-e70982de3fb6",
          "name": "Successful Request"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                  "name": "timestamp",
                  "value": "={{ new Date().toISOString() }}",
                  "type": "string"
                },
                {
                  "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                  "name": "execution_id",
                  "value": "={{ $execution.id }}",
                  "type": "string"
                },
                {
                  "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                  "name": "workflow_name",
                  "value": "Takealot Status Change Webhook",
                  "type": "string"
                },
                {
                  "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                  "name": "seller_id",
                  "value": "={{ $('Webhook').item.json.params.seller_id }}",
                  "type": "string"
                },
                {
                  "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                  "name": "order_item_id",
                  "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                  "type": "string"
                },
                {
                  "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                  "name": "stage",
                  "value": "Recursive request",
                  "type": "string"
                },
                {
                  "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                  "name": "status",
                  "value": "self-heal",
                  "type": "string"
                },
                {
                  "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                  "name": "message",
                  "value": "Recursive request bad response",
                  "type": "string"
                },
                {
                  "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                  "name": "details",
                  "value": "={{ $('Webhook').item.json.toJsonString() }}",
                  "type": "object"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            3888,
            816
          ],
          "id": "f744b335-f2ae-413d-b437-d9a24889cae3",
          "name": "Log Entry - Bad request"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://urbanetrains.backendless.app/api/data/n8n-status-change-webhook-workflow-logs",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={{ $json }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            4048,
            816
          ],
          "id": "c9f51758-b518-4040-b38b-3724e4c92907",
          "name": "Log bad request"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "76b9b3c3-dc42-4b56-bbf0-0597eb51f0db",
                  "leftValue": "={{ $json.packages }}",
                  "rightValue": "",
                  "operator": {
                    "type": "array",
                    "operation": "exists",
                    "singleValue": true
                  }
                },
                {
                  "id": "0471f1e8-acdf-4e45-8444-7864bff5acf5",
                  "leftValue": "={{ $json.packages.length }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "number",
                    "operation": "gt"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            4320,
            368
          ],
          "id": "b041bee5-366d-414e-9f3c-275e82fe4e29",
          "name": "Has self heal worked?"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "1ced0d19-28eb-4e5d-b556-2e046c9c5e5d",
                  "name": "timestamp",
                  "value": "={{ new Date().toISOString() }}",
                  "type": "string"
                },
                {
                  "id": "4e64f3c8-d974-4fae-9ebd-bb45214d4be1",
                  "name": "execution_id",
                  "value": "={{ $execution.id }}",
                  "type": "string"
                },
                {
                  "id": "8702cca0-98d2-4e2d-8e19-acd328a74ef3",
                  "name": "workflow_name",
                  "value": "Takealot Status Change Webhook",
                  "type": "string"
                },
                {
                  "id": "5670fd65-139e-44c3-97f2-6e187f07b4ac",
                  "name": "seller_id",
                  "value": "={{ $('Webhook').item.json.params.seller_id }}",
                  "type": "string"
                },
                {
                  "id": "eaab8a22-445b-4150-9070-f79194a1f828",
                  "name": "order_item_id",
                  "value": "={{ $('Webhook').item.json.body.sale.order_item_id }}",
                  "type": "string"
                },
                {
                  "id": "44c6ebce-ef9a-4a89-84d7-517054a0052c",
                  "name": "stage",
                  "value": "Recursion",
                  "type": "string"
                },
                {
                  "id": "27aa2e80-1b7a-46ef-ad91-4b5603efd30d",
                  "name": "status",
                  "value": "error",
                  "type": "string"
                },
                {
                  "id": "34ee7c18-dcec-4d4c-80ca-b14d6a4da038",
                  "name": "message",
                  "value": "Self Heal failed",
                  "type": "string"
                },
                {
                  "id": "0cdf2735-de3c-4c6f-b0f7-7f10664800dc",
                  "name": "details",
                  "value": "={{ $('Webhook').item.json.toJsonString() }}",
                  "type": "object"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            4544,
            448
          ],
          "id": "e58ad088-1b71-4bd2-b3d4-d584a36ed223",
          "name": "Log Entry - Self-Heal fail"
        }
      ],
      "connections": {
        "Webhook": {
          "main": [
            [
              {
                "node": "Get row(s)",
                "type": "main",
                "index": 0
              },
              {
                "node": "Extract from File",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Zoho Access Token": {
          "main": [
            [
              {
                "node": "Get Item ID from SKU",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Item ID from SKU": {
          "main": [
            [
              {
                "node": "Build JSON",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set Endpoint": {
          "main": [
            [
              {
                "node": "if valid transaction",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Build JSON": {
          "main": [
            [
              {
                "node": "Switch1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Mark Invoice as Sent": {
          "main": [
            [
              {
                "node": "Map to Salesorder",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get row(s)": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "if valid transaction": {
          "main": [
            [
              {
                "node": "Get Zoho Access Token",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "No Operation, do nothing",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Confirm Salesorder": {
          "main": [
            [
              {
                "node": "Get Created SO",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Log Entry - SO Confirm Fail",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Package": {
          "main": [
            [
              {
                "node": "Does Package Exist?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create Shipment": {
          "main": [
            [
              {
                "node": "Is Shipment Delivered?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Mark as Delivered": {
          "main": [
            [
              {
                "node": "Get Invoices",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create Sales Return": {
          "main": [
            [
              {
                "node": "Receive Sales Return",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch1": {
          "main": [
            [
              {
                "node": "Check for Existing SO",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Get Package",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Get Original Sales Order Number",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create Salesorder": {
          "main": [
            [
              {
                "node": "Validate SO Creation",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Log Entry - Failed SO Create",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create Invoice": {
          "main": [
            [
              {
                "node": "Extract invoice_id",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Receive Sales Return": {
          "main": [
            [
              {
                "node": "Create Credit Note",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Original Sales Order Number": {
          "main": [
            [
              {
                "node": "Found Original Sales Order",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get SO Details": {
          "main": [
            [
              {
                "node": "Check for Existing SR",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Found Original Sales Order": {
          "main": [
            [
              {
                "node": "Get SO Details",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "No Operation, do nothing1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Check for Existing SR": {
          "main": [
            [
              {
                "node": "SR Exists",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "SR Exists": {
          "main": [
            [
              {
                "node": "Available for return",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Create Sales Return",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Available for return": {
          "main": [
            [
              {
                "node": "Update SR",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "No Operation, do nothing2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Check for Existing SO": {
          "main": [
            [
              {
                "node": "SO Exists?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "SO Exists?": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Create Salesorder",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Validate SO Creation": {
          "main": [
            [
              {
                "node": "Validate SO Data",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Log Entry - Invalid SO",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Validate SO Data": {
          "main": [
            [
              {
                "node": "Confirm Salesorder",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Check Package Prerequisites": {
          "main": [
            [
              {
                "node": "Create package",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Log Entry - Package Prerequisites failed",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create package": {
          "main": [
            [
              {
                "node": "Log Entry - Success",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Log Entry - Create Package failed",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "Log Entry - SO = Void",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Get Existing SO",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Validate SO Data",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Created SO": {
          "main": [
            [
              {
                "node": "Check Package Prerequisites",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Existing SO": {
          "main": [
            [
              {
                "node": "Check Package Prerequisites",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Log Entry - Package Prerequisites failed": {
          "main": [
            [
              {
                "node": "Log Result to Backendless",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Log Entry - Success": {
          "main": [
            [
              {
                "node": "Log Result to Backendless",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Log Entry - Create Package failed": {
          "main": [
            [
              {
                "node": "Log Result to Backendless",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Log Entry - SO Confirm Fail": {
          "main": [
            [
              {
                "node": "Log Result to Backendless",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Log Entry - Invalid SO": {
          "main": [
            [
              {
                "node": "Log Result to Backendless",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Log Entry - Failed SO Create": {
          "main": [
            [
              {
                "node": "Log Result to Backendless",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Log Entry - SO = Void": {
          "main": [
            [
              {
                "node": "Log Event to Backendless",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Does Package Exist?": {
          "main": [
            [
              {
                "node": "Shipment Exists?",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Log Entry - Self-Heal start",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Shipment Exists?": {
          "main": [
            [
              {
                "node": "Get Shipment",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Create Shipment",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Is Shipment Delivered?": {
          "main": [
            [
              {
                "node": "Get Invoices",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Mark as Delivered",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Shipment": {
          "main": [
            [
              {
                "node": "Is Shipment Delivered?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Invoices": {
          "main": [
            [
              {
                "node": "Invoice Exists?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Invoice Exists?": {
          "main": [
            [
              {
                "node": "Get Invoice",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Create Invoice",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Invoice": {
          "main": [
            [
              {
                "node": "Extract invoice_id",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract invoice_id": {
          "main": [
            [
              {
                "node": "Mark Invoice as Sent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Recursive call": {
          "main": [
            [
              {
                "node": "Successful Request",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Log Entry - Self-Heal start": {
          "main": [
            [
              {
                "node": "Log status to Backendless",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Log status to Backendless": {
          "main": [
            [
              {
                "node": "Prevent infinite loop",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Log Entry - Failed Recursion": {
          "main": [
            [
              {
                "node": "Log Recursion fail to Backendless",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Prevent infinite loop": {
          "main": [
            [
              {
                "node": "Log Entry - Failed Recursion",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Recursive call",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait 5 sec": {
          "main": [
            [
              {
                "node": "Get Package1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Package1": {
          "main": [
            [
              {
                "node": "Has self heal worked?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTTP Request": {
          "main": [
            [
              {
                "node": "Check HMAC",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Crypto": {
          "main": [
            [
              {
                "node": "HTTP Request",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Crypto",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Check HMAC": {
          "main": [
            [
              {
                "node": "Set Endpoint",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Log Entry - SO = Void1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Convert to File": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Convert to File",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract from File": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Log Entry - SO = Void1": {
          "main": [
            [
              {
                "node": "Log HMAC failure",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Log HMAC failure": {
          "main": [
            [
              {
                "node": "Set Endpoint",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Log result": {
          "main": [
            []
          ]
        },
        "Successful Request": {
          "main": [
            [
              {
                "node": "Wait 5 sec",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Log Entry - Bad request",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Log Entry - Bad request": {
          "main": [
            [
              {
                "node": "Log bad request",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Has self heal worked?": {
          "main": [
            [
              {
                "node": "Shipment Exists?",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Log Entry - Self-Heal fail",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Log Entry - Self-Heal fail": {
          "main": [
            [
              {
                "node": "Log result",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "authors": "Mark Wilson",
      "name": "Version 888123ae",
      "description": "",
      "autosaved": false,
      "workflowPublishHistory": [
        {
          "createdAt": "2026-02-04T15:12:57.631Z",
          "id": 56,
          "workflowId": "XYhKungDNJV46vQF",
          "versionId": "888123ae-30c6-4d4b-92c7-19c812041d1c",
          "event": "activated",
          "userId": "cb6b4be4-4f57-4999-b61c-7cb9ecfa4a89"
        }
      ]
    }
  }
]